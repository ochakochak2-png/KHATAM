<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem DeMas - Sistem Semakan Bacaan Harian</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        
        .star-animation {
            animation: starPulse 2s infinite;
        }
        
        @keyframes starPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .celebration {
            animation: celebrate 0.6s ease-out;
        }
        
        @keyframes celebrate {
            0% { transform: scale(0.8) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .trophy-glow {
            animation: trophyGlow 2s infinite alternate;
        }
        
        @keyframes trophyGlow {
            0% { 
                box-shadow: 0 0 5px rgba(255, 193, 7, 0.3);
                transform: scale(1);
            }
            100% { 
                box-shadow: 0 0 20px rgba(255, 193, 7, 0.6);
                transform: scale(1.02);
            }
        }
        
        .modal-backdrop {
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="gradient-bg text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="text-3xl">ğŸŒ™</div>
                <h1 class="text-2xl font-bold">Sistem DeMas</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button onclick="switchView('dashboard')" class="px-4 py-2 bg-white bg-opacity-30 rounded-lg hover:bg-opacity-40 transition-all" id="dashboardBtn">Dashboard</button>
                <button onclick="switchView('murid')" class="px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all" id="muridBtn">Murid</button>
                <button onclick="switchView('ibubapa')" class="px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all" id="ibubapaBtn">Ibu Bapa</button>
                <button onclick="switchView('guru')" class="px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all" id="guruBtn">Guru</button>
                <button onclick="switchView('gurubesar')" class="px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all" id="gurubesarBtn">Guru Besar</button>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard -->
    <div id="dashboardView" class="container mx-auto p-6">
        <!-- Welcome Header -->
        <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 rounded-xl text-white p-8 mb-6 shadow-2xl">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold mb-2">ğŸŒ™ Selamat Datang ke Sistem DeMas</h1>
                    <p class="text-xl opacity-90">Sistem Semakan Bacaan Harian Al-Quran - Kelas 6 Aktif</p>
                    <p class="text-lg opacity-80 mt-2">ğŸ“… Minggu Semasa: 21 - 27 Disember 2024</p>
                </div>
                <div class="text-right">
                    <div class="text-6xl mb-2">ğŸ“Š</div>
                    <div class="text-sm opacity-80">Analisis Terkini</div>
                </div>
            </div>
        </div>

        <!-- Key Statistics Overview -->
        <div class="grid md:grid-cols-5 gap-6 mb-8">
            <div class="bg-white rounded-xl p-6 text-center shadow-lg border-l-4 border-blue-500">
                <div class="text-3xl mb-3">ğŸ‘¥</div>
                <h3 class="text-lg font-semibold text-gray-800">Jumlah Murid</h3>
                <p class="text-3xl font-bold text-blue-600" id="dashTotalStudents">17</p>
                <p class="text-sm text-gray-600">Kelas 6 Aktif</p>
            </div>
            
            <div class="bg-gradient-to-br from-purple-100 to-pink-100 rounded-xl p-6 text-center shadow-lg border-4 border-purple-400 trophy-glow">
                <div class="flex items-center justify-center space-x-2 mb-3">
                    <span class="text-4xl animate-pulse">ğŸ†</span>
                </div>
                <h3 class="text-lg font-bold text-purple-800">KHATAM</h3>
                <p class="text-3xl font-bold text-purple-600" id="dashKhatamCount">0</p>
                <p class="text-xs text-purple-700 font-semibold">604+ muka surat</p>
            </div>
            
            <div class="bg-gradient-to-br from-yellow-100 to-orange-100 rounded-xl p-6 text-center shadow-lg border-2 border-yellow-300">
                <div class="flex items-center justify-center space-x-2 mb-3">
                    <span class="text-3xl">ğŸ†</span>
                </div>
                <h3 class="text-lg font-semibold text-yellow-800">Layak Sijil</h3>
                <p class="text-3xl font-bold text-yellow-600" id="dashCertificateCount">0</p>
                <p class="text-xs text-yellow-700">308+ muka surat</p>
            </div>
            
            <div class="bg-white rounded-xl p-6 text-center shadow-lg border-l-4 border-green-500">
                <div class="text-3xl mb-3">ğŸ“ˆ</div>
                <h3 class="text-lg font-semibold text-gray-800">Purata Prestasi</h3>
                <p class="text-3xl font-bold text-green-600" id="dashAveragePerformance">72%</p>
                <p class="text-sm text-gray-600">Target Mingguan</p>
            </div>
            
            <div class="bg-white rounded-xl p-6 text-center shadow-lg border-l-4 border-red-500">
                <div class="text-3xl mb-3">âš ï¸</div>
                <h3 class="text-lg font-semibold text-gray-800">Perlu Perhatian</h3>
                <p class="text-3xl font-bold text-red-600" id="dashNeedsAttention">3</p>
                <p class="text-sm text-gray-600">Murid</p>
            </div>
        </div>

        <!-- Performance Charts -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <!-- Weekly Progress Chart -->
            <div class="bg-white rounded-xl p-6 shadow-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“Š Kemajuan Mingguan Keseluruhan</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-700">Target Tercapai (70%+)</span>
                        <span class="text-sm font-bold text-green-600" id="weeklyTargetAchieved">12 murid</span>
                    </div>
                    <div class="bg-gray-200 rounded-full h-4">
                        <div class="bg-gradient-to-r from-green-400 to-green-600 h-4 rounded-full transition-all duration-1000" 
                             style="width: 71%" id="weeklyProgressChart"></div>
                    </div>
                    <div class="text-center text-sm text-gray-600">71% murid mencapai target mingguan</div>
                </div>
                
                <!-- Daily Breakdown -->
                <div class="mt-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">Pecahan Harian</h4>
                    <div class="grid grid-cols-7 gap-2">
                        <div class="text-center">
                            <div class="text-xs text-gray-600 mb-1">Isn</div>
                            <div class="bg-green-100 rounded-lg p-2">
                                <div class="text-sm font-bold text-green-600">100%</div>
                                <div class="text-xs text-gray-500">17/17</div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-600 mb-1">Sel</div>
                            <div class="bg-green-100 rounded-lg p-2">
                                <div class="text-sm font-bold text-green-600">100%</div>
                                <div class="text-xs text-gray-500">17/17</div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-600 mb-1">Rab</div>
                            <div class="bg-green-100 rounded-lg p-2">
                                <div class="text-sm font-bold text-green-600">100%</div>
                                <div class="text-xs text-gray-500">17/17</div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-600 mb-1">Kha</div>
                            <div class="bg-yellow-100 rounded-lg p-2">
                                <div class="text-sm font-bold text-yellow-600">88%</div>
                                <div class="text-xs text-gray-500">15/17</div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-600 mb-1">Jum</div>
                            <div class="bg-blue-100 rounded-lg p-2 border-2 border-blue-300">
                                <div class="text-sm font-bold text-blue-600">65%</div>
                                <div class="text-xs text-gray-500">11/17</div>
                                <div class="text-xs text-blue-600 font-bold">HARI INI</div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-600 mb-1">Sab</div>
                            <div class="bg-gray-100 rounded-lg p-2">
                                <div class="text-sm font-bold text-gray-400">-</div>
                                <div class="text-xs text-gray-400">0/17</div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-600 mb-1">Ahd</div>
                            <div class="bg-gray-100 rounded-lg p-2">
                                <div class="text-sm font-bold text-gray-400">-</div>
                                <div class="text-xs text-gray-400">0/17</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Distribution -->
            <div class="bg-white rounded-xl p-6 shadow-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ¯ Taburan Prestasi</h3>
                <div class="space-y-4">
                    <!-- Excellent Performance -->
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">â­</span>
                            <div>
                                <div class="font-semibold text-green-800">Cemerlang (90%+)</div>
                                <div class="text-sm text-green-600">Target mingguan terlampaui</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-green-600" id="excellentCount">5</div>
                            <div class="text-sm text-green-700">murid</div>
                        </div>
                    </div>
                    
                    <!-- Good Performance -->
                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">ğŸ‘</span>
                            <div>
                                <div class="font-semibold text-blue-800">Baik (70-89%)</div>
                                <div class="text-sm text-blue-600">Hampir mencapai target</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-blue-600" id="goodCount">7</div>
                            <div class="text-sm text-blue-700">murid</div>
                        </div>
                    </div>
                    
                    <!-- Average Performance -->
                    <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-500">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">ğŸ“š</span>
                            <div>
                                <div class="font-semibold text-yellow-800">Sederhana (50-69%)</div>
                                <div class="text-sm text-yellow-600">Perlu galakan tambahan</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-yellow-600" id="averageCount">3</div>
                            <div class="text-sm text-yellow-700">murid</div>
                        </div>
                    </div>
                    
                    <!-- Needs Attention -->
                    <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg border-l-4 border-red-500">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">âš ï¸</span>
                            <div>
                                <div class="font-semibold text-red-800">Perlu Perhatian (<50%)</div>
                                <div class="text-sm text-red-600">Memerlukan bimbingan khusus</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-red-600" id="attentionCount">2</div>
                            <div class="text-sm text-red-700">murid</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Performers and Trending -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <!-- Top Performers -->
            <div class="bg-white rounded-xl p-6 shadow-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ† Pencapaian Terbaik Minggu Ini</h3>
                <div class="space-y-3" id="topPerformers">
                    <!-- Top performers will be populated by JavaScript -->
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="bg-white rounded-xl p-6 shadow-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“‹ Aktiviti Terkini</h3>
                <div class="space-y-3" id="recentActivities">
                    <div class="flex items-center space-x-3 p-3 bg-green-50 rounded-lg border-l-4 border-green-400">
                        <span class="text-lg">âœ…</span>
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-800">Adrina menyelesaikan bacaan hari ini</div>
                            <div class="text-xs text-gray-500">11 muka surat â€¢ 2 jam yang lalu</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3 p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                        <span class="text-lg">ğŸ’¬</span>
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-800">Ibu bapa Adam menambah ulasan</div>
                            <div class="text-xs text-gray-500">"Alhamdulillah, teruskan usaha" â€¢ 3 jam yang lalu</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-400">
                        <span class="text-lg">ğŸ†</span>
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-800">Khairunnisa layak menerima sijil bulanan</div>
                            <div class="text-xs text-gray-500">315 muka surat dicapai â€¢ 1 hari yang lalu</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3 p-3 bg-purple-50 rounded-lg border-l-4 border-purple-400">
                        <span class="text-lg">ğŸ¯</span>
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-800">Fakhir mencapai target mingguan</div>
                            <div class="text-xs text-gray-500">77 muka surat selesai â€¢ 1 hari yang lalu</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monthly Progress Overview -->
        <div class="bg-white rounded-xl p-6 shadow-lg mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“… Kemajuan Bulanan (Disember 2024)</h3>
            <div class="grid md:grid-cols-4 gap-4 mb-6">
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600">308</div>
                    <div class="text-sm text-blue-700">Target Bulanan</div>
                    <div class="text-xs text-gray-600">Muka Surat</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <div class="text-2xl font-bold text-green-600" id="monthlyAverage">285</div>
                    <div class="text-sm text-green-700">Purata Pencapaian</div>
                    <div class="text-xs text-gray-600">Muka Surat</div>
                </div>
                <div class="text-center p-4 bg-yellow-50 rounded-lg">
                    <div class="text-2xl font-bold text-yellow-600" id="monthlyEligible">8</div>
                    <div class="text-sm text-yellow-700">Layak Sijil</div>
                    <div class="text-xs text-gray-600">Murid</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded-lg">
                    <div class="text-2xl font-bold text-purple-600">93%</div>
                    <div class="text-sm text-purple-700">Pencapaian Keseluruhan</div>
                    <div class="text-xs text-gray-600">Kelas</div>
                </div>
            </div>
            
            <!-- Monthly Progress Bar -->
            <div class="space-y-2">
                <div class="flex justify-between text-sm text-gray-600">
                    <span>Kemajuan Bulanan Keseluruhan</span>
                    <span>285/308 muka surat (93%)</span>
                </div>
                <div class="bg-gray-200 rounded-full h-4">
                    <div class="bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 h-4 rounded-full transition-all duration-1000" 
                         style="width: 93%"></div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6 shadow-lg border-2 border-indigo-200">
            <h3 class="text-xl font-bold text-gray-800 mb-4">âš¡ Tindakan Pantas</h3>
            <div class="grid md:grid-cols-4 gap-4">
                <button onclick="switchView('murid')" class="bg-blue-500 text-white p-4 rounded-lg hover:bg-blue-600 transition-colors text-center">
                    <div class="text-2xl mb-2">ğŸ‘¥</div>
                    <div class="font-semibold">Lihat Data Murid</div>
                    <div class="text-sm opacity-80">Semak kemajuan individu</div>
                </button>
                <button onclick="switchView('guru')" class="bg-green-500 text-white p-4 rounded-lg hover:bg-green-600 transition-colors text-center">
                    <div class="text-2xl mb-2">ğŸ‘¨â€ğŸ«</div>
                    <div class="font-semibold">Panel Guru</div>
                    <div class="text-sm opacity-80">Urus data dan sijil</div>
                </button>
                <button onclick="downloadDashboardReport()" class="bg-purple-500 text-white p-4 rounded-lg hover:bg-purple-600 transition-colors text-center">
                    <div class="text-2xl mb-2">ğŸ“Š</div>
                    <div class="font-semibold">Muat Turun Laporan</div>
                    <div class="text-sm opacity-80">Analisis lengkap</div>
                </button>
                <button onclick="switchView('ibubapa')" class="bg-orange-500 text-white p-4 rounded-lg hover:bg-orange-600 transition-colors text-center">
                    <div class="text-2xl mb-2">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                    <div class="font-semibold">Portal Ibu Bapa</div>
                    <div class="text-sm opacity-80">Akses data anak</div>
                </button>
            </div>
        </div>
    </div>

    <!-- Student Dashboard -->
    <div id="muridView" class="container mx-auto p-6 hidden">
        <!-- Student Selection -->
        <div class="bg-white rounded-xl card-shadow p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">ğŸ‘¥ Pilih Murid</h3>
            <select id="studentSelect" onchange="loadSelectedStudent()" class="w-full p-3 border border-gray-300 rounded-lg">
                <option value="">-- Pilih Nama Murid --</option>
                <option value="0">Adrina</option>
                <option value="1">Adam</option>
                <option value="2">Khairunnisa</option>
                <option value="3">Fakhir</option>
                <option value="4">Afiq</option>
                <option value="5">Naim</option>
                <option value="6">Hafiz</option>
                <option value="7">Danish</option>
                <option value="8">Syarhan</option>
                <option value="9">Adawiyah</option>
                <option value="10">Syadatul</option>
                <option value="11">Isma</option>
                <option value="12">Dhia</option>
                <option value="13">Syafina</option>
                <option value="14">Aisyah</option>
                <option value="15">Siti Hajar</option>
                <option value="16">Rosmawati</option>
            </select>
        </div>

        <!-- Student Data Container -->
        <div id="studentDataContainer" class="hidden">
            <!-- Student Header -->
            <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full flex items-center justify-center text-2xl text-white font-bold" id="studentInitial">
                            A
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800" id="selectedStudentName">Nama Murid</h2>
                            <p class="text-gray-600">Kelas 6 Aktif</p>
                            <div id="khatamStatus" class="hidden mt-2">
                                <div class="flex items-center space-x-2">
                                    <span class="text-2xl animate-pulse">ğŸ†</span>
                                    <span class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-3 py-1 rounded-full text-sm font-bold">KHATAM ACHIEVED!</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-yellow-500 text-2xl" id="starCount">â­â­â­â­â­</span>
                            <span class="text-lg font-semibold text-gray-700" id="starText">5 Bintang</span>
                        </div>
                        <p class="text-sm text-gray-500">Target Minggu: 77 Muka Surat</p>
                    </div>
                </div>
            </div>

            <!-- Progress Overview -->
            <div class="grid md:grid-cols-4 gap-6 mb-6">
                <div class="bg-green-100 rounded-xl p-6 text-center">
                    <div class="text-3xl mb-2">ğŸ“–</div>
                    <h3 class="text-lg font-semibold text-green-800">Hari Ini</h3>
                    <p class="text-2xl font-bold text-green-600" id="todayProgress">8/11</p>
                    <p class="text-sm text-green-700">Muka Surat</p>
                </div>
                <div class="bg-blue-100 rounded-xl p-6 text-center">
                    <div class="text-3xl mb-2">ğŸ“…</div>
                    <h3 class="text-lg font-semibold text-blue-800">Minggu Ini</h3>
                    <p class="text-2xl font-bold text-blue-600" id="weekProgress">52/77</p>
                    <p class="text-sm text-blue-700">Muka Surat</p>
                </div>
                <div class="bg-purple-100 rounded-xl p-6 text-center">
                    <div class="text-3xl mb-2">ğŸ†</div>
                    <h3 class="text-lg font-semibold text-purple-800">Pencapaian</h3>
                    <p class="text-2xl font-bold text-purple-600" id="achievementPercent">67%</p>
                    <p class="text-sm text-purple-700">Target Tercapai</p>
                </div>
                <div class="bg-gradient-to-br from-purple-100 to-pink-100 rounded-xl p-6 text-center border-2 border-purple-300" id="semesterProgressCard">
                    <div class="text-3xl mb-2" id="semesterIcon">ğŸ“š</div>
                    <h3 class="text-lg font-semibold text-purple-800">Semester</h3>
                    <p class="text-2xl font-bold text-purple-600" id="semesterProgress">520/604</p>
                    <p class="text-sm text-purple-700" id="semesterStatus">Menuju KHATAM</p>
                </div>
            </div>

            <!-- Daily Reading Schedule -->
            <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“… Jadual Bacaan Mingguan</h3>
                <div class="space-y-4" id="weeklySchedule">
                    <!-- Days will be populated by JavaScript -->
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“Š Kemajuan Minggu Ini</h3>
                <div class="bg-gray-200 rounded-full h-6 mb-2">
                    <div class="bg-gradient-to-r from-green-400 to-blue-500 h-6 rounded-full progress-bar" style="width: 67%" id="weeklyProgressBar"></div>
                </div>
                <p class="text-center text-gray-600" id="progressText">52 daripada 77 muka surat (67%)</p>
            </div>
        </div>
    </div>

    <!-- Parent Dashboard -->
    <div id="ibubapaView" class="container mx-auto p-6 hidden">
        <div class="bg-white rounded-xl card-shadow p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Panel Ibu Bapa - Kelas 6 Aktif</h2>
            
            <!-- Parent ID Verification -->
            <div id="parentLoginSection" class="mb-6">
                <div class="bg-blue-50 rounded-lg p-6 border-2 border-blue-200">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="text-3xl">ğŸ”</div>
                        <div>
                            <h3 class="text-lg font-semibold text-blue-800">Pengesahan Identiti Ibu Bapa</h3>
                            <p class="text-sm text-blue-700">Sila masukkan No. Kad Pengenalan untuk mengakses data anak anda</p>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-blue-700 mb-2">NO. KAD PENGENALAN:</label>
                            <input type="text" id="parentIDInput" placeholder="Contoh: 850312-05-1234" 
                                   class="w-full p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   maxlength="14" onkeypress="return validateICInput(event)" oninput="formatICNumber(this)">
                            <div class="text-xs text-blue-600 mt-1">
                                ğŸ’¡ Format: YYMMDD-PP-XXXX (contoh: 850312-05-1234)
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="verifyParentID()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors flex-1">
                                ğŸ” Sahkan Identiti
                            </button>
                            <button onclick="showParentIDDemo()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors">
                                ğŸ“‹ Lihat Contoh ID
                            </button>
                        </div>
                    </div>
                    
                    <!-- Security Notice -->
                    <div class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg">
                        <div class="flex items-center space-x-2">
                            <span class="text-yellow-600 text-lg">âš ï¸</span>
                            <div class="text-sm text-yellow-800">
                                <strong>Penting:</strong> Setiap ibu bapa hanya boleh mengakses dan mengisi data bacaan anak mereka sahaja. 
                                Sistem akan mengenal pasti anak anda berdasarkan No. Kad Pengenalan yang didaftarkan.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Parent Access Status -->
            <div id="parentAccessStatus" class="mb-6 hidden">
                <div class="bg-green-50 rounded-lg p-4 border-2 border-green-200">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">âœ…</div>
                            <div>
                                <h4 class="font-semibold text-green-800">Identiti Disahkan</h4>
                                <p class="text-sm text-green-700" id="authorizedParentInfo">Selamat datang! Anda kini boleh mengakses data anak anda.</p>
                            </div>
                        </div>
                        <button onclick="logoutParent()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm">
                            ğŸšª Log Keluar
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Student Selection (Only shown after verification) -->
            <div id="parentStudentSection" class="mb-6 hidden">
                <div class="bg-gray-50 rounded-lg p-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Anak Anda:</label>
                    <div class="flex items-center space-x-3 p-3 bg-white rounded-lg border-2 border-blue-200">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full flex items-center justify-center text-white font-bold text-lg" id="childInitial">A</div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800" id="childName">Nama Anak</h3>
                            <p class="text-sm text-gray-600">Kelas 6 Aktif</p>
                        </div>
                        <button onclick="loadStudentDataForParent()" class="ml-auto bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            ğŸ“Š Lihat Data Bacaan
                        </button>
                    </div>
                </div>
            </div>

            <!-- Student Details -->
            <div id="parentStudentDetails" class="hidden">
                <!-- Current Day Selection -->
                <div class="bg-blue-50 rounded-lg p-4 mb-4">
                    <h3 class="text-lg font-semibold text-blue-800 mb-3">ğŸ“… Pilih Hari untuk Pengisian Data</h3>
                    <div class="grid grid-cols-7 gap-2" id="parentDaySelector">
                        <!-- Days will be populated by JavaScript -->
                    </div>
                </div>

                <div class="border rounded-lg p-4 mb-4">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold" id="parentSelectedStudent">Nama Murid</h3>
                            <p class="text-sm text-gray-600" id="parentSelectedDay">Hari: Khamis, 21 Disember 2023</p>
                        </div>
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm" id="parentStudentStatus">Aktif</span>
                    </div>
                    
                    <!-- Edit Reading Data -->
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Muka Surat:</label>
                            <input type="number" id="parentEditPages" class="w-full p-2 border border-gray-300 rounded" min="0" max="20">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Juzuk:</label>
                            <input type="number" id="parentEditJuzuk" class="w-full p-2 border border-gray-300 rounded" min="1" max="30">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Catatan:</label>
                        <textarea id="parentEditNotes" class="w-full p-2 border border-gray-300 rounded" rows="2" placeholder="Tambah catatan..."></textarea>
                    </div>
                    
                    <div class="flex space-x-2 mb-4" id="parentActionButtons">
                        <button onclick="saveParentEdit()" id="saveDataBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            ğŸ’¾ Simpan Data
                        </button>
                        <button onclick="confirmReading()" id="confirmBtn" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            âœ… Sahkan Bacaan
                        </button>
                        <button onclick="addComment()" id="commentBtn" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                            ğŸ’¬ Tambah Ulasan
                        </button>
                    </div>
                    
                    <!-- Due Time Warning -->
                    <div id="dueTimeWarning" class="hidden mb-4 p-4 bg-red-50 border-l-4 border-red-400 rounded-lg">
                        <div class="flex items-center">
                            <div class="text-red-500 text-xl mr-3">âš ï¸</div>
                            <div>
                                <h4 class="text-red-800 font-semibold">Masa Tamat Tempoh!</h4>
                                <p class="text-red-700 text-sm" id="warningMessage">Pengesahan data hanya boleh dibuat pada hari yang sama sebelum jam 12:00 malam.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Data Entry History -->
                    <div id="parentDataHistory" class="mt-4 pt-4 border-t">
                        <h4 class="text-md font-semibold text-gray-800 mb-3">ğŸ“‹ Sejarah Pengisian Data</h4>
                        <div id="parentHistoryList" class="space-y-2">
                            <!-- History will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Headmaster Dashboard -->
    <div id="gurubesarView" class="container mx-auto p-6 hidden">
        <div class="bg-white rounded-xl card-shadow p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“ Panel Guru Besar - Kelas 6 Aktif</h2>
            
            <!-- Overall Performance Overview -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl text-center border-2 border-blue-200">
                    <div class="text-4xl mb-3">ğŸ“Š</div>
                    <h3 class="text-lg font-semibold text-blue-800">Pencapaian Keseluruhan</h3>
                    <p class="text-3xl font-bold text-blue-600" id="overallPerformanceScore">87%</p>
                    <p class="text-sm text-blue-700">Skor Prestasi Kelas</p>
                </div>
                
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl text-center border-2 border-green-200">
                    <div class="text-4xl mb-3">ğŸ†</div>
                    <h3 class="text-lg font-semibold text-green-800">KHATAM Achievers</h3>
                    <p class="text-3xl font-bold text-green-600" id="headmasterKhatamCount">0</p>
                    <p class="text-sm text-green-700">Murid (604+ muka surat)</p>
                </div>
                
                <div class="bg-gradient-to-br from-yellow-50 to-orange-50 p-6 rounded-xl text-center border-2 border-yellow-200">
                    <div class="text-4xl mb-3">ğŸ“œ</div>
                    <h3 class="text-lg font-semibold text-yellow-800">Layak Sijil</h3>
                    <p class="text-3xl font-bold text-yellow-600" id="headmasterCertificateCount">8</p>
                    <p class="text-sm text-yellow-700">Murid (308+ muka surat)</p>
                </div>
                
                <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-xl text-center border-2 border-purple-200">
                    <div class="text-4xl mb-3">ğŸ“ˆ</div>
                    <h3 class="text-lg font-semibold text-purple-800">Trend Prestasi</h3>
                    <p class="text-3xl font-bold text-purple-600" id="performanceTrend">+12%</p>
                    <p class="text-sm text-purple-700">Berbanding 6 bulan lalu</p>
                </div>
            </div>

            <!-- Performance Analysis Chart -->
            <div class="bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl p-6 mb-8 border-2 border-gray-200">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ˆ Analisis Prestasi 6 Bulan Terakhir</h3>
                <div class="grid md:grid-cols-6 gap-4 mb-4">
                    <div class="text-center p-3 bg-white rounded-lg shadow">
                        <div class="text-sm text-gray-600 mb-1">Jul 2024</div>
                        <div class="text-lg font-bold text-blue-600">75%</div>
                        <div class="bg-blue-200 rounded-full h-2 mt-1">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: 75%"></div>
                        </div>
                    </div>
                    <div class="text-center p-3 bg-white rounded-lg shadow">
                        <div class="text-sm text-gray-600 mb-1">Ogs 2024</div>
                        <div class="text-lg font-bold text-blue-600">78%</div>
                        <div class="bg-blue-200 rounded-full h-2 mt-1">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: 78%"></div>
                        </div>
                    </div>
                    <div class="text-center p-3 bg-white rounded-lg shadow">
                        <div class="text-sm text-gray-600 mb-1">Sep 2024</div>
                        <div class="text-lg font-bold text-blue-600">82%</div>
                        <div class="bg-blue-200 rounded-full h-2 mt-1">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: 82%"></div>
                        </div>
                    </div>
                    <div class="text-center p-3 bg-white rounded-lg shadow">
                        <div class="text-sm text-gray-600 mb-1">Okt 2024</div>
                        <div class="text-lg font-bold text-blue-600">85%</div>
                        <div class="bg-blue-200 rounded-full h-2 mt-1">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: 85%"></div>
                        </div>
                    </div>
                    <div class="text-center p-3 bg-white rounded-lg shadow">
                        <div class="text-sm text-gray-600 mb-1">Nov 2024</div>
                        <div class="text-lg font-bold text-blue-600">86%</div>
                        <div class="bg-blue-200 rounded-full h-2 mt-1">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: 86%"></div>
                        </div>
                    </div>
                    <div class="text-center p-3 bg-white rounded-lg shadow border-2 border-green-300">
                        <div class="text-sm text-gray-600 mb-1">Dis 2024</div>
                        <div class="text-lg font-bold text-green-600">87%</div>
                        <div class="bg-green-200 rounded-full h-2 mt-1">
                            <div class="bg-green-500 h-2 rounded-full" style="width: 87%"></div>
                        </div>
                        <div class="text-xs text-green-600 font-bold mt-1">SEMASA</div>
                    </div>
                </div>
                <div class="text-center text-sm text-gray-600">
                    ğŸ“Š Peningkatan konsisten sebanyak 12% dalam tempoh 6 bulan
                </div>
            </div>

            <!-- Headmaster Comments and Justification -->
            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-6 mb-8 border-2 border-yellow-200">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ’¬ Ulasan & Justifikasi Guru Besar</h3>
                
                <!-- Current Comments Display -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-700 mb-3">Ulasan Semasa:</h4>
                    <div id="currentHeadmasterComments" class="space-y-3">
                        <div class="bg-white p-4 rounded-lg border-l-4 border-blue-400 shadow-sm">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-semibold text-blue-800">Ulasan Prestasi Disember 2024</span>
                                <span class="text-xs text-gray-500">15 Disember 2024, 2:30 PM</span>
                            </div>
                            <p class="text-gray-700 mb-2">Alhamdulillah, pencapaian kelas 6 Aktif menunjukkan peningkatan yang memberangsangkan. Skor keseluruhan 87% adalah antara yang terbaik dalam sekolah. Sistem DeMas telah membantu meningkatkan keterlibatan ibu bapa dan pemantauan harian yang lebih sistematik.</p>
                            <div class="text-sm text-blue-600 font-medium">Justifikasi: Peningkatan 12% berbanding 6 bulan lalu menunjukkan keberkesanan pendekatan digital dan keterlibatan ibu bapa yang aktif.</div>
                        </div>
                    </div>
                </div>

                <!-- Add New Comment Section -->
                <div class="bg-white p-4 rounded-lg border-2 border-dashed border-gray-300">
                    <h4 class="text-lg font-semibold text-gray-700 mb-3">Tambah Ulasan Baru:</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tajuk Ulasan:</label>
                            <input type="text" id="headmasterCommentTitle" class="w-full p-3 border border-gray-300 rounded-lg" 
                                   placeholder="Contoh: Ulasan Prestasi Januari 2025">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ulasan & Justifikasi:</label>
                            <textarea id="headmasterCommentText" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" 
                                      placeholder="Tulis ulasan dan justifikasi prestasi kelas..."></textarea>
                        </div>
                        <button onclick="addHeadmasterComment()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors">
                            ğŸ’¬ Simpan Ulasan
                        </button>
                    </div>
                </div>
            </div>

            <!-- 6-Monthly Verification Section -->
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 mb-8 border-2 border-green-200">
                <h3 class="text-xl font-bold text-gray-800 mb-4">âœ… Pengesahan Berkala Guru Besar (6 Bulan)</h3>
                
                <!-- Verification History -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-700 mb-3">Sejarah Pengesahan:</h4>
                    <div id="verificationHistory" class="space-y-3">
                        <div class="bg-white p-4 rounded-lg border-l-4 border-green-400 shadow-sm">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="text-2xl">âœ…</span>
                                    <span class="font-semibold text-green-800">Pengesahan Semester 2/2024</span>
                                </div>
                                <span class="text-xs text-gray-500">30 Jun 2024, 4:45 PM</span>
                            </div>
                            <p class="text-gray-700 mb-2">Sistem DeMas telah berjaya dilaksanakan dengan pencapaian keseluruhan 75%. Semua murid menunjukkan kemajuan yang positif dalam bacaan harian Al-Quran.</p>
                            <div class="text-sm text-green-600 font-medium">Status: DISAHKAN - Tempoh: Januari - Jun 2024</div>
                        </div>
                    </div>
                </div>

                <!-- Current Verification Period -->
                <div class="bg-white p-4 rounded-lg border-2 border-green-300">
                    <h4 class="text-lg font-semibold text-gray-700 mb-3">Pengesahan Semasa (Julai - Disember 2024):</h4>
                    
                    <!-- Verification Summary -->
                    <div class="grid md:grid-cols-3 gap-4 mb-4">
                        <div class="text-center p-3 bg-blue-50 rounded-lg">
                            <div class="text-lg font-bold text-blue-600">6 Bulan</div>
                            <div class="text-sm text-blue-700">Tempoh Semasa</div>
                        </div>
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <div class="text-lg font-bold text-green-600">87%</div>
                            <div class="text-sm text-green-700">Skor Pencapaian</div>
                        </div>
                        <div class="text-center p-3 bg-yellow-50 rounded-lg">
                            <div class="text-lg font-bold text-yellow-600">+12%</div>
                            <div class="text-sm text-yellow-700">Peningkatan</div>
                        </div>
                    </div>

                    <!-- Verification Form -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ulasan Pengesahan:</label>
                            <textarea id="verificationComment" class="w-full p-3 border border-gray-300 rounded-lg" rows="3" 
                                      placeholder="Tulis ulasan untuk pengesahan 6 bulan ini..."></textarea>
                        </div>
                        
                        <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                            <div class="flex items-center space-x-2 text-sm text-yellow-800">
                                <span class="text-lg">â„¹ï¸</span>
                                <span><strong>Nota:</strong> Pengesahan ini akan merekodkan prestasi kelas untuk tempoh Julai - Disember 2024. Sila pastikan semua data telah disemak sebelum pengesahan.</span>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="verifyPeriod()" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors flex-1">
                                âœ… Sahkan Tempoh 6 Bulan
                            </button>
                            <button onclick="previewVerificationReport()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors flex-1">
                                ğŸ‘ï¸ Pratonton Laporan
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Performance Breakdown -->
            <div class="bg-white rounded-xl p-6 shadow-lg">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“‹ Pecahan Prestasi Terperinci</h3>
                
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="border border-gray-300 p-3 text-left">Kategori</th>
                                <th class="border border-gray-300 p-3 text-center">Bilangan Murid</th>
                                <th class="border border-gray-300 p-3 text-center">Peratusan</th>
                                <th class="border border-gray-300 p-3 text-center">Target</th>
                                <th class="border border-gray-300 p-3 text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody id="headmasterPerformanceTable">
                            <!-- Table will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Teacher Dashboard -->
    <div id="guruView" class="container mx-auto p-6 hidden">
        <div class="bg-white rounded-xl card-shadow p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ‘¨â€ğŸ« Panel Guru - Kelas 6 Aktif</h2>
            <div class="grid md:grid-cols-5 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    <h4 class="font-semibold text-blue-800">Jumlah Murid</h4>
                    <p class="text-2xl font-bold text-blue-600" id="totalStudents">17</p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-4 rounded-lg text-center border-4 border-purple-300 trophy-glow">
                    <div class="flex items-center justify-center space-x-2 mb-2">
                        <span class="text-3xl animate-pulse">ğŸ†</span>
                        <h4 class="font-bold text-purple-800">KHATAM</h4>
                    </div>
                    <p class="text-2xl font-bold text-purple-600" id="khatamAchieversCount">0</p>
                    <p class="text-xs text-purple-700 font-semibold">604+ muka surat</p>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg text-center border-2 border-yellow-200">
                    <div class="flex items-center justify-center space-x-2 mb-2">
                        <span class="text-2xl">ğŸ†</span>
                        <h4 class="font-semibold text-yellow-800">Sijil Bulanan</h4>
                    </div>
                    <p class="text-2xl font-bold text-yellow-600" id="certificateEligibleCount">0</p>
                    <p class="text-xs text-yellow-700">308+ muka surat</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg text-center">
                    <h4 class="font-semibold text-green-800">Target Tercapai</h4>
                    <p class="text-2xl font-bold text-green-600" id="targetAchieved">12</p>
                </div>
                <div class="bg-red-50 p-4 rounded-lg text-center">
                    <h4 class="font-semibold text-red-800">Perlu Perhatian</h4>
                    <p class="text-2xl font-bold text-red-600" id="needsAttention">5</p>
                </div>
            </div>
            
            <!-- Analytics and Student Management Section -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <!-- Analytics Download -->
                <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border-2 border-blue-200">
                    <h3 class="text-lg font-semibold text-blue-800 mb-3">ğŸ“Š Analisa Data Keseluruhan</h3>
                    <p class="text-sm text-blue-700 mb-4">Muat turun laporan lengkap prestasi semua murid dalam format Excel</p>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-blue-700 mb-1">Pilih Tempoh Laporan:</label>
                            <select id="reportPeriod" class="w-full p-2 border border-blue-300 rounded">
                                <option value="daily">Laporan Harian</option>
                                <option value="weekly">Laporan Mingguan</option>
                                <option value="monthly">Laporan Bulanan</option>
                                <option value="semester">Laporan Semester</option>
                            </select>
                        </div>
                        <button onclick="downloadAnalytics()" class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            ğŸ“¥ Muat Turun Analisa Excel
                        </button>
                        <button onclick="previewAnalytics()" class="w-full bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 transition-colors">
                            ğŸ‘ï¸ Pratonton Analisa
                        </button>
                    </div>
                </div>

                <!-- Student Management -->
                <div class="p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border-2 border-green-200">
                    <h3 class="text-lg font-semibold text-green-800 mb-3">ğŸ‘¥ Pengurusan Murid</h3>
                    <p class="text-sm text-green-700 mb-4">Tambah murid baru atau keluarkan murid yang berpindah</p>
                    <div class="space-y-3">
                        <button onclick="openAddStudentModal()" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            â• Tambah Murid Baru
                        </button>
                        <button onclick="openRemoveStudentModal()" class="w-full bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                            â– Keluarkan Murid
                        </button>
                        <button onclick="openEditStudentModal()" class="w-full bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors">
                            âœï¸ Edit Nama Murid
                        </button>
                    </div>
                </div>
            </div>

            <!-- Certificate Generation Section -->
            <div class="mb-6 p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg border-2 border-yellow-200">
                <h3 class="text-lg font-semibold text-yellow-800 mb-3">ğŸ† Sijil Penghargaan Bulanan (Target: 308 Muka Surat)</h3>
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-yellow-700 mb-1">Pilih Murid:</label>
                        <select id="certificateStudentSelect" onchange="checkCertificateEligibility()" class="w-full p-2 border border-yellow-300 rounded">
                            <option value="">-- Pilih Murid --</option>
                            <option value="0">Adrina</option>
                            <option value="1">Adam</option>
                            <option value="2">Khairunnisa</option>
                            <option value="3">Fakhir</option>
                            <option value="4">Afiq</option>
                            <option value="5">Naim</option>
                            <option value="6">Hafiz</option>
                            <option value="7">Danish</option>
                            <option value="8">Syarhan</option>
                            <option value="9">Adawiyah</option>
                            <option value="10">Syadatul</option>
                            <option value="11">Isma</option>
                            <option value="12">Dhia</option>
                            <option value="13">Syafina</option>
                            <option value="14">Aisyah</option>
                            <option value="15">Siti Hajar</option>
                            <option value="16">Rosmawati</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-yellow-700 mb-1">Bulan & Tahun:</label>
                        <input type="month" id="certificateMonth" class="w-full p-2 border border-yellow-300 rounded" value="2024-12">
                        <div class="text-xs text-yellow-600 mt-1">ğŸ“… Pilih bulan dan tahun untuk sijil</div>
                    </div>
                </div>
                
                <!-- Certificate Eligibility Status -->
                <div id="certificateStatus" class="mb-4 p-3 rounded-lg border hidden">
                    <div class="flex items-center space-x-3">
                        <div id="statusIcon" class="text-2xl"></div>
                        <div>
                            <h4 id="statusTitle" class="font-semibold"></h4>
                            <p id="statusMessage" class="text-sm"></p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                    <div class="flex items-center space-x-2 text-sm text-yellow-800">
                        <span class="text-lg">â„¹ï¸</span>
                        <span><strong>Kriteria Kelayakan:</strong> Murid mesti mencapai sekurang-kurangnya 308 muka surat dalam sebulan untuk layak menerima sijil penghargaan.</span>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="generateCertificate()" id="generateCertBtn" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                        ğŸ† Jana Sijil PDF
                    </button>
                    <button onclick="previewCertificate()" id="previewCertBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                        ğŸ‘ï¸ Pratonton Sijil
                    </button>
                </div>
            </div>

            <!-- Edit Student Data Section -->
            <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">âœï¸ Edit Data Murid</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Pilih Murid:</label>
                        <select id="teacherStudentSelect" onchange="loadStudentDataForTeacher()" class="w-full p-2 border border-gray-300 rounded">
                            <option value="">-- Pilih Murid --</option>
                            <option value="0">Adrina</option>
                            <option value="1">Adam</option>
                            <option value="2">Khairunnisa</option>
                            <option value="3">Fakhir</option>
                            <option value="4">Afiq</option>
                            <option value="5">Naim</option>
                            <option value="6">Hafiz</option>
                            <option value="7">Danish</option>
                            <option value="8">Syarhan</option>
                            <option value="9">Adawiyah</option>
                            <option value="10">Syadatul</option>
                            <option value="11">Isma</option>
                            <option value="12">Dhia</option>
                            <option value="13">Syafina</option>
                            <option value="14">Aisyah</option>
                            <option value="15">Siti Hajar</option>
                            <option value="16">Rosmawati</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Muka Surat Hari Ini:</label>
                        <input type="number" id="teacherEditPages" class="w-full p-2 border border-gray-300 rounded" min="0" max="20">
                    </div>
                </div>
                <div class="mt-3">
                    <button onclick="saveTeacherEdit()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                        ğŸ’¾ Simpan Perubahan
                    </button>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="border border-gray-300 p-3 text-left">Nama Murid</th>
                            <th class="border border-gray-300 p-3 text-center">Kemajuan Minggu</th>
                            <th class="border border-gray-300 p-3 text-center">Status</th>
                            <th class="border border-gray-300 p-3 text-center">Tindakan</th>
                        </tr>
                    </thead>
                    <tbody id="teacherStudentTable">
                        <!-- Table will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md mx-4 text-center celebration">
            <div class="text-6xl mb-4">ğŸ‰</div>
            <h3 class="text-2xl font-bold text-green-600 mb-2">Tahniah!</h3>
            <p class="text-gray-700 mb-4" id="successMessage">Anda telah mencapai sasaran hari ini!</p>
            <div class="text-4xl mb-4 star-animation">â­</div>
            <button onclick="closeModal()" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                Terima Kasih!
            </button>
        </div>
    </div>

    <!-- Comment Modal -->
    <div id="commentModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-md mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ’¬ Tambah Ulasan</h3>
            <textarea id="commentText" class="w-full p-3 border border-gray-300 rounded-lg mb-4" rows="3" placeholder="Tulis ulasan anda di sini..."></textarea>
            <div class="flex space-x-3">
                <button onclick="saveComment()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex-1">
                    Simpan
                </button>
                <button onclick="closeCommentModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors flex-1">
                    Batal
                </button>
            </div>
        </div>
    </div>

    <!-- Certificate Preview Modal -->
    <div id="certificatePreviewModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-4xl mx-4 w-full max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">ğŸ† Pratonton Sijil Penghargaan</h3>
                <button onclick="closeCertificatePreview()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            
            <!-- Certificate Design -->
            <div id="certificateDesign" class="bg-gradient-to-br from-yellow-50 via-white to-orange-50 border-8 border-yellow-400 rounded-lg p-8 text-center shadow-2xl">
                <!-- Certificate Header -->
                <div class="mb-6">
                    <div class="text-6xl mb-4">ğŸ†</div>
                    <h1 class="text-4xl font-bold text-yellow-600 mb-2">SIJIL PENGHARGAAN</h1>
                    <div class="w-32 h-1 bg-yellow-400 mx-auto mb-4"></div>
                    <p class="text-lg text-gray-700">Sistem Semakan Bacaan Harian (DeMas)</p>
                </div>
                
                <!-- Award Text -->
                <div class="mb-8">
                    <p class="text-xl text-gray-800 mb-4">Sijil ini diberikan kepada</p>
                    <h2 id="certificateStudentName" class="text-5xl font-bold text-blue-600 mb-4 border-b-4 border-blue-300 pb-2">NAMA MURID</h2>
                    <p class="text-lg text-gray-700 mb-2">Kelas 6 Aktif</p>
                </div>
                
                <!-- Achievement Details -->
                <div class="mb-8 bg-white bg-opacity-70 rounded-lg p-6 border-2 border-yellow-300">
                    <p class="text-xl text-gray-800 mb-4">Atas pencapaian cemerlang dalam</p>
                    <h3 class="text-2xl font-bold text-green-600 mb-4">BACAAN AL-QURAN HARIAN</h3>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div class="bg-green-100 rounded-lg p-3">
                            <div class="text-2xl font-bold text-green-600" id="certificatePages">308</div>
                            <div class="text-sm text-green-700">Muka Surat Dibaca</div>
                        </div>
                        <div class="bg-blue-100 rounded-lg p-3">
                            <div class="text-2xl font-bold text-blue-600" id="certificatePercentage">100%</div>
                            <div class="text-sm text-blue-700">Target 308 Tercapai</div>
                        </div>
                    </div>
                    <p class="text-lg text-gray-700 mt-4">Bulan: <span id="certificateMonthDisplay" class="font-bold text-purple-600">Disember 2024</span></p>
                </div>
                
                <!-- Motivational Quote -->
                <div class="mb-8">
                    <div class="text-3xl mb-2">ğŸ“–</div>
                    <p class="text-lg italic text-gray-600 border-l-4 border-yellow-400 pl-4">
                        "Dan sesungguhnya telah Kami mudahkan Al-Quran untuk pelajaran, 
                        maka adakah orang yang mengambil pelajaran?"
                    </p>
                    <p class="text-sm text-gray-500 mt-2">- Al-Qamar: 17</p>
                </div>
                
                <!-- Signatures -->
                <div class="grid grid-cols-2 gap-8 mt-8">
                    <div class="text-center">
                        <div class="border-t-2 border-gray-400 pt-2">
                            <p class="font-semibold text-gray-700">Guru Kelas</p>
                            <p class="text-sm text-gray-500">Cikgu Aminah</p>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="border-t-2 border-gray-400 pt-2">
                            <p class="font-semibold text-gray-700">Tarikh</p>
                            <p class="text-sm text-gray-500" id="certificateDate">31 Disember 2024</p>
                        </div>
                    </div>
                </div>
                
                <!-- Decorative Elements -->
                <div class="absolute top-4 left-4 text-4xl text-yellow-400 opacity-30">â­</div>
                <div class="absolute top-4 right-4 text-4xl text-yellow-400 opacity-30">â­</div>
                <div class="absolute bottom-4 left-4 text-4xl text-yellow-400 opacity-30">ğŸŒŸ</div>
                <div class="absolute bottom-4 right-4 text-4xl text-yellow-400 opacity-30">ğŸŒŸ</div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex space-x-3 mt-6">
                <button onclick="downloadCertificatePDF()" class="bg-yellow-500 text-white px-6 py-3 rounded-lg hover:bg-yellow-600 transition-colors flex-1">
                    ğŸ“¥ Muat Turun PDF
                </button>
                <button onclick="closeCertificatePreview()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors flex-1">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- Analytics Preview Modal -->
    <div id="analyticsPreviewModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-6xl mx-4 w-full max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">ğŸ“Š Pratonton Analisa Data</h3>
                <button onclick="closeAnalyticsPreview()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            
            <!-- Summary Statistics -->
            <div class="grid md:grid-cols-4 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    <h4 class="font-semibold text-blue-800">Jumlah Murid</h4>
                    <p class="text-2xl font-bold text-blue-600" id="analyticsTotalStudents">17</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg text-center">
                    <h4 class="font-semibold text-green-800">Purata Prestasi</h4>
                    <p class="text-2xl font-bold text-green-600" id="analyticsAveragePerformance">72%</p>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg text-center">
                    <h4 class="font-semibold text-yellow-800">Layak Sijil</h4>
                    <p class="text-2xl font-bold text-yellow-600" id="analyticsCertificateEligible">8</p>
                </div>
                <div class="bg-red-50 p-4 rounded-lg text-center">
                    <h4 class="font-semibold text-red-800">Perlu Perhatian</h4>
                    <p class="text-2xl font-bold text-red-600" id="analyticsNeedsAttention">3</p>
                </div>
            </div>

            <!-- Detailed Table -->
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300 text-sm">
                    <thead class="bg-gray-50">
                        <tr id="analyticsTableHeader">
                            <th class="border border-gray-300 p-2 text-left">Nama Murid</th>
                            <th class="border border-gray-300 p-2 text-center">Minggu Ini</th>
                            <th class="border border-gray-300 p-2 text-center">Bulanan</th>
                            <th class="border border-gray-300 p-2 text-center">Prestasi</th>
                            <th class="border border-gray-300 p-2 text-center">Status</th>
                            <th class="border border-gray-300 p-2 text-center">Hari Lengkap</th>
                        </tr>
                    </thead>
                    <tbody id="analyticsTableBody">
                        <!-- Table content will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex space-x-3 mt-6">
                <button onclick="downloadAnalyticsFromPreview()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors flex-1">
                    ğŸ“¥ Muat Turun Excel
                </button>
                <button onclick="closeAnalyticsPreview()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors flex-1">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-md mx-4 w-full">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">â• Tambah Murid Baru</h3>
                <button onclick="closeAddStudentModal()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nama Murid:</label>
                    <input type="text" id="newStudentName" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="Masukkan nama murid baru">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">No. Kad Pengenalan Ibu Bapa:</label>
                    <input type="text" id="newParentID" class="w-full p-3 border border-gray-300 rounded-lg" 
                           placeholder="Contoh: 850312-05-1234" maxlength="14" 
                           onkeypress="return validateICInput(event)" oninput="formatICNumber(this)">
                    <div class="text-xs text-gray-600 mt-1">
                        ğŸ’¡ Format: YYMMDD-PP-XXXX (contoh: 850312-05-1234)
                    </div>
                </div>
                
                <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                    <div class="flex items-center space-x-2 text-sm text-blue-800">
                        <span class="text-lg">â„¹ï¸</span>
                        <span>Murid baru akan ditambah dengan data kosong dan boleh mula mengisi bacaan dari hari ini. No. IC ibu bapa diperlukan untuk keselamatan akses data.</span>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="addNewStudent()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors flex-1">
                    â• Tambah Murid
                </button>
                <button onclick="closeAddStudentModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors flex-1">
                    Batal
                </button>
            </div>
        </div>
    </div>

    <!-- Remove Student Modal -->
    <div id="removeStudentModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-md mx-4 w-full">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">â– Keluarkan Murid</h3>
                <button onclick="closeRemoveStudentModal()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Pilih Murid untuk Dikeluarkan:</label>
                    <select id="removeStudentSelect" class="w-full p-3 border border-gray-300 rounded-lg">
                        <option value="">-- Pilih Murid --</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Sebab Pengeluaran:</label>
                    <select id="removalReason" class="w-full p-3 border border-gray-300 rounded-lg">
                        <option value="transfer">Berpindah Sekolah</option>
                        <option value="class_change">Tukar Kelas</option>
                        <option value="other">Lain-lain</option>
                    </select>
                </div>
                
                <div class="bg-red-50 p-3 rounded-lg border border-red-200">
                    <div class="flex items-center space-x-2 text-sm text-red-800">
                        <span class="text-lg">âš ï¸</span>
                        <span><strong>Amaran:</strong> Tindakan ini akan memadamkan semua data murid secara kekal dan tidak boleh dibatalkan.</span>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="removeStudent()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors flex-1">
                    ğŸ—‘ï¸ Keluarkan Murid
                </button>
                <button onclick="closeRemoveStudentModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors flex-1">
                    Batal
                </button>
            </div>
        </div>
    </div>

    <!-- Parent ID Demo Modal -->
    <div id="parentIDDemoModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-4xl mx-4 w-full max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">ğŸ“‹ Senarai No. Kad Pengenalan Ibu Bapa</h3>
                <button onclick="closeParentIDDemo()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            
            <div class="bg-yellow-50 p-4 rounded-lg border-2 border-yellow-200 mb-6">
                <div class="flex items-center space-x-2 text-sm text-yellow-800">
                    <span class="text-lg">â„¹ï¸</span>
                    <span><strong>Nota:</strong> Ini adalah senarai untuk tujuan demonstrasi sahaja. Dalam sistem sebenar, maklumat ini adalah sulit dan hanya diketahui oleh ibu bapa masing-masing.</span>
                </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div class="space-y-3">
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Adrina</div>
                        <div class="text-sm text-blue-700">IC: 850312-05-1234</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Adam</div>
                        <div class="text-sm text-blue-700">IC: 780925-14-5678</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Khairunnisa</div>
                        <div class="text-sm text-blue-700">IC: 821204-03-9012</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Fakhir</div>
                        <div class="text-sm text-blue-700">IC: 790618-08-3456</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Afiq</div>
                        <div class="text-sm text-blue-700">IC: 831127-12-7890</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Naim</div>
                        <div class="text-sm text-blue-700">IC: 770503-06-2345</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Hafiz</div>
                        <div class="text-sm text-blue-700">IC: 840815-10-6789</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Danish</div>
                        <div class="text-sm text-blue-700">IC: 760229-02-0123</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Syarhan</div>
                        <div class="text-sm text-blue-700">IC: 820707-11-4567</div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Adawiyah</div>
                        <div class="text-sm text-blue-700">IC: 791010-07-8901</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Syadatul</div>
                        <div class="text-sm text-blue-700">IC: 851223-04-2345</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Isma</div>
                        <div class="text-sm text-blue-700">IC: 780416-09-6789</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Dhia</div>
                        <div class="text-sm text-blue-700">IC: 830908-01-0123</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Syafina</div>
                        <div class="text-sm text-blue-700">IC: 771130-13-4567</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Aisyah</div>
                        <div class="text-sm text-blue-700">IC: 820521-05-8901</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Siti Hajar</div>
                        <div class="text-sm text-blue-700">IC: 790803-15-2345</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="font-semibold text-blue-800">Rosmawati</div>
                        <div class="text-sm text-blue-700">IC: 841014-06-6789</div>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 p-4 bg-green-50 rounded-lg border-2 border-green-200">
                <h4 class="font-semibold text-green-800 mb-2">Cara Menggunakan:</h4>
                <ol class="text-sm text-green-700 space-y-1">
                    <li>1. Pilih No. IC yang berkaitan dengan anak anda dari senarai di atas</li>
                    <li>2. Salin dan tampal No. IC tersebut ke dalam kotak "NO. KAD PENGENALAN"</li>
                    <li>3. Klik butang "ğŸ” Sahkan Identiti" untuk mengakses data anak anda</li>
                    <li>4. Setelah disahkan, anda boleh mengisi dan mengesahkan data bacaan anak anda</li>
                </ol>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="closeParentIDDemo()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors flex-1">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="editStudentModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-md mx-4 w-full">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">âœï¸ Edit Nama Murid</h3>
                <button onclick="closeEditStudentModal()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Pilih Murid:</label>
                    <select id="editStudentSelect" onchange="loadStudentForEdit()" class="w-full p-3 border border-gray-300 rounded-lg">
                        <option value="">-- Pilih Murid --</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nama Baru:</label>
                    <input type="text" id="editStudentName" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="Masukkan nama baru">
                </div>
                
                <div class="bg-orange-50 p-3 rounded-lg border border-orange-200">
                    <div class="flex items-center space-x-2 text-sm text-orange-800">
                        <span class="text-lg">â„¹ï¸</span>
                        <span>Perubahan nama akan dikemas kini di semua bahagian sistem termasuk laporan dan sijil.</span>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="updateStudentName()" class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors flex-1">
                    âœï¸ Kemaskini Nama
                </button>
                <button onclick="closeEditStudentModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors flex-1">
                    Batal
                </button>
            </div>
        </div>
    </div>

    <!-- Student Detail Modal -->
    <div id="studentDetailModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-2xl mx-4 w-full max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800" id="detailStudentName">Detail Murid</h3>
                <button onclick="closeStudentDetailModal()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            
            <!-- Student Info Header -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 mb-6">
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full flex items-center justify-center text-2xl text-white font-bold" id="detailStudentInitial">
                        A
                    </div>
                    <div>
                        <h4 class="text-xl font-semibold text-gray-800" id="detailStudentFullName">Nama Murid</h4>
                        <p class="text-gray-600">Kelas 6 Aktif</p>
                        <div class="flex items-center space-x-2 mt-1">
                            <span class="text-yellow-500" id="detailStars">â­â­â­â­â­</span>
                            <span class="text-sm text-gray-600" id="detailStarText">5 Bintang</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Summary -->
            <div class="grid md:grid-cols-3 gap-4 mb-6">
                <div class="bg-green-100 rounded-lg p-4 text-center">
                    <div class="text-2xl mb-2">ğŸ“–</div>
                    <h5 class="font-semibold text-green-800">Hari Ini</h5>
                    <p class="text-xl font-bold text-green-600" id="detailTodayPages">8/11</p>
                    <p class="text-sm text-green-700">Muka Surat</p>
                </div>
                <div class="bg-blue-100 rounded-lg p-4 text-center">
                    <div class="text-2xl mb-2">ğŸ“…</div>
                    <h5 class="font-semibold text-blue-800">Minggu Ini</h5>
                    <p class="text-xl font-bold text-blue-600" id="detailWeekPages">52/77</p>
                    <p class="text-sm text-blue-700">Muka Surat</p>
                </div>
                <div class="bg-purple-100 rounded-lg p-4 text-center">
                    <div class="text-2xl mb-2">ğŸ†</div>
                    <h5 class="font-semibold text-purple-800">Pencapaian</h5>
                    <p class="text-xl font-bold text-purple-600" id="detailPercentage">67%</p>
                    <p class="text-sm text-purple-700">Target Tercapai</p>
                </div>
            </div>

            <!-- Weekly Progress Chart -->
            <div class="mb-6">
                <h5 class="text-lg font-semibold text-gray-800 mb-3">ğŸ“Š Kemajuan Mingguan</h5>
                <div class="bg-gray-200 rounded-full h-4 mb-2">
                    <div class="bg-gradient-to-r from-green-400 to-blue-500 h-4 rounded-full transition-all duration-500" id="detailProgressBar" style="width: 67%"></div>
                </div>
                <p class="text-center text-gray-600" id="detailProgressText">52 daripada 77 muka surat (67%)</p>
            </div>

            <!-- Daily Breakdown -->
            <div class="mb-6">
                <h5 class="text-lg font-semibold text-gray-800 mb-3">ğŸ“… Pecahan Harian</h5>
                <div class="grid grid-cols-7 gap-2" id="detailDailyBreakdown">
                    <!-- Daily data will be populated here -->
                </div>
            </div>

            <!-- Performance Status -->
            <div class="mb-6">
                <h5 class="text-lg font-semibold text-gray-800 mb-3">ğŸ“ˆ Status Prestasi</h5>
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-700">Status Keseluruhan:</span>
                        <span class="px-3 py-1 rounded-full text-sm font-medium" id="detailOverallStatus">Cemerlang</span>
                    </div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-700">Hari Selesai:</span>
                        <span class="font-semibold" id="detailCompletedDays">4/7 hari</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-700">Purata Harian:</span>
                        <span class="font-semibold" id="detailDailyAverage">7.4 muka surat</span>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-3">
                <button onclick="editStudentFromDetail()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex-1">
                    âœï¸ Edit Data
                </button>
                <button onclick="addStudentComment()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors flex-1">
                    ğŸ’¬ Tambah Ulasan
                </button>
                <button onclick="closeStudentDetailModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors flex-1">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        const weekDays = ['Isnin', 'Selasa', 'Rabu', 'Khamis', 'Jumaat', 'Sabtu', 'Ahad'];
        const dailyTargets = [11, 11, 11, 11, 11, 11, 11];
        const currentProgress = [11, 11, 11, 11, 8, 0, 0]; // Pages read each day
        const comments = {
            'Isnin': ['Bagus sekali! - Ibu', 'Teruskan usaha - Cikgu'],
            'Selasa': ['Alhamdulillah - Ibu'],
            'Rabu': ['Bacaan yang lancar - Cikgu'],
            'Khamis': ['Tahniah anak! - Ayah']
        };

        // Student data for all 17 students
        const students = [
            'Adrina', 'Adam', 'Khairunnisa', 'Fakhir', 'Afiq', 'Naim', 'Hafiz', 'Danish', 
            'Syarhan', 'Adawiyah', 'Syadatul', 'Isma', 'Dhia', 'Syafina', 'Aisyah', 'Siti Hajar', 'Rosmawati'
        ];

        // Parent ID mapping for each student (IC numbers)
        const parentIDs = {
            0: '850312-05-1234',   // Adrina
            1: '780925-14-5678',   // Adam
            2: '821204-03-9012',   // Khairunnisa
            3: '790618-08-3456',   // Fakhir
            4: '831127-12-7890',   // Afiq
            5: '770503-06-2345',   // Naim
            6: '840815-10-6789',   // Hafiz
            7: '760229-02-0123',   // Danish
            8: '820707-11-4567',   // Syarhan
            9: '791010-07-8901',   // Adawiyah
            10: '851223-04-2345',  // Syadatul
            11: '780416-09-6789',  // Isma
            12: '830908-01-0123',  // Dhia
            13: '771130-13-4567',  // Syafina
            14: '820521-05-8901',  // Aisyah
            15: '790803-15-2345',  // Siti Hajar
            16: '841014-06-6789'   // Rosmawati
        };

        // Track parent login status
        let currentParentID = null;
        let authorizedStudentIndex = null;

        // Student progress data (pages read this week)
        const studentProgress = [
            77, 52, 48, 81, 44, 58, 77, 39, 55, 67, 41, 77, 46, 59, 35, 68, 50
        ];

        // Monthly progress data for certificate eligibility (308 pages per month target)
        const monthlyProgress = [
            315, 298, 285, 324, 276, 289, 312, 256, 278, 305, 264, 318, 284, 296, 240, 308, 290
        ];

        // Total semester progress for KHATAM achievement (604 pages target)
        const semesterProgress = [
            620, 580, 550, 650, 520, 590, 625, 480, 560, 610, 500, 640, 540, 595, 450, 615, 570
        ];

        // KHATAM target: 604 pages per semester
        const khatamTarget = 604;

        // Monthly target: 308 pages per month
        const monthlyTarget = 308;

        // Today's reading data for each student
        const todayReading = [
            9, 8, 7, 11, 6, 8, 9, 5, 8, 10, 6, 11, 7, 8, 5, 10, 7
        ];

        // Individual student weekly progress (7 days for each student)
        const studentWeeklyData = [
            [11, 11, 11, 11, 9, 0, 0],   // Adrina
            [11, 11, 11, 11, 8, 0, 0],   // Adam
            [11, 11, 11, 7, 7, 0, 0],    // Khairunnisa
            [11, 11, 11, 11, 11, 0, 0],  // Fakhir
            [11, 11, 11, 6, 6, 0, 0],    // Afiq
            [11, 11, 11, 8, 8, 0, 0],    // Naim
            [11, 11, 11, 11, 9, 0, 0],   // Hafiz
            [11, 11, 11, 5, 5, 0, 0],    // Danish
            [11, 11, 11, 8, 8, 0, 0],    // Syarhan
            [11, 11, 11, 11, 10, 0, 0],  // Adawiyah
            [11, 11, 11, 6, 6, 0, 0],    // Syadatul
            [11, 11, 11, 11, 11, 0, 0],  // Isma
            [11, 11, 11, 7, 7, 0, 0],    // Dhia
            [11, 11, 11, 8, 8, 0, 0],    // Syafina
            [11, 11, 11, 5, 5, 0, 0],    // Aisyah
            [11, 11, 11, 11, 10, 0, 0],  // Siti Hajar
            [11, 11, 11, 7, 7, 0, 0]     // Rosmawati
        ];

        let selectedStudentIndex = null;
        let selectedDayIndex = 4; // Default to Thursday (today)
        
        // Data entry history for each student
        window.studentDataHistory = {};
        
        // Daily data for each student (7 days x 17 students)
        window.studentDailyData = {};
        
        // Initialize daily data structure
        students.forEach((student, studentIndex) => {
            window.studentDailyData[studentIndex] = {};
            window.studentDataHistory[studentIndex] = {};
            
            weekDays.forEach((day, dayIndex) => {
                window.studentDailyData[studentIndex][dayIndex] = {
                    pages: studentWeeklyData[studentIndex][dayIndex],
                    juzuk: Math.ceil(studentWeeklyData[studentIndex][dayIndex] / 4) || 1,
                    notes: '',
                    lastUpdated: null,
                    updatedBy: null
                };
                window.studentDataHistory[studentIndex][dayIndex] = [];
            });
        });

        // Load selected student data
        function loadSelectedStudent() {
            const select = document.getElementById('studentSelect');
            selectedStudentIndex = select.value;
            
            if (selectedStudentIndex !== '') {
                const studentName = students[selectedStudentIndex];
                const studentData = studentWeeklyData[selectedStudentIndex];
                const weeklyTotal = studentProgress[selectedStudentIndex];
                const todayPages = todayReading[selectedStudentIndex];
                const semesterTotal = semesterProgress[selectedStudentIndex];
                const isKhatam = semesterTotal >= khatamTarget;
                
                // Update student info
                document.getElementById('selectedStudentName').textContent = studentName;
                document.getElementById('studentInitial').textContent = studentName.charAt(0).toUpperCase();
                
                // Show/hide KHATAM status
                const khatamStatusDiv = document.getElementById('khatamStatus');
                if (isKhatam) {
                    khatamStatusDiv.classList.remove('hidden');
                } else {
                    khatamStatusDiv.classList.add('hidden');
                }
                
                // Update progress displays
                document.getElementById('todayProgress').textContent = `${todayPages}/11`;
                document.getElementById('weekProgress').textContent = `${weeklyTotal}/77`;
                document.getElementById('achievementPercent').textContent = `${Math.round((weeklyTotal/77)*100)}%`;
                document.getElementById('progressText').textContent = `${weeklyTotal} daripada 77 muka surat (${Math.round((weeklyTotal/77)*100)}%)`;
                
                // Update semester progress
                document.getElementById('semesterProgress').textContent = `${semesterTotal}/604`;
                const semesterCard = document.getElementById('semesterProgressCard');
                const semesterIcon = document.getElementById('semesterIcon');
                const semesterStatus = document.getElementById('semesterStatus');
                const semesterProgressBar = document.getElementById('semesterProgressBar');
                const semesterPercentage = document.getElementById('semesterPercentage');
                
                const semesterPercent = Math.round((semesterTotal/604)*100);
                const remaining = Math.max(0, 604 - semesterTotal);
                
                if (semesterProgressBar) {
                    semesterProgressBar.style.width = `${semesterPercent}%`;
                }
                
                if (semesterPercentage) {
                    semesterPercentage.textContent = `${semesterPercent}% (${remaining} lagi)`;
                }
                
                if (isKhatam) {
                    semesterCard.className = 'bg-gradient-to-br from-purple-100 to-pink-100 rounded-xl p-6 text-center border-4 border-purple-400 trophy-glow';
                    semesterIcon.textContent = 'ğŸ†';
                    semesterStatus.textContent = 'KHATAM TERCAPAI!';
                    semesterStatus.className = 'text-sm text-purple-800 font-bold';
                    if (semesterPercentage) {
                        semesterPercentage.textContent = '100% KHATAM! ğŸ†';
                        semesterPercentage.className = 'text-xs text-purple-800 font-bold mt-1 animate-pulse';
                    }
                } else {
                    semesterCard.className = 'bg-gradient-to-br from-purple-100 to-pink-100 rounded-xl p-6 text-center border-2 border-purple-300';
                    semesterIcon.textContent = 'ğŸ“š';
                    semesterStatus.textContent = `${remaining} lagi untuk KHATAM`;
                    semesterStatus.className = 'text-sm text-purple-700';
                    if (semesterPercentage) {
                        semesterPercentage.className = 'text-xs text-purple-600 mt-1';
                    }
                }
                
                // Update stars based on performance
                const percentage = (weeklyTotal/77)*100;
                let stars = '';
                let starCount = 0;
                if (isKhatam) { stars = 'â­â­â­â­â­ğŸ†'; starCount = 6; }
                else if (percentage >= 90) { stars = 'â­â­â­â­â­'; starCount = 5; }
                else if (percentage >= 80) { stars = 'â­â­â­â­'; starCount = 4; }
                else if (percentage >= 70) { stars = 'â­â­â­'; starCount = 3; }
                else if (percentage >= 60) { stars = 'â­â­'; starCount = 2; }
                else { stars = 'â­'; starCount = 1; }
                
                document.getElementById('starCount').textContent = stars;
                document.getElementById('starText').textContent = isKhatam ? 'KHATAM Champion!' : `${starCount} Bintang`;
                
                // Update progress bar
                document.getElementById('weeklyProgressBar').style.width = `${Math.round((weeklyTotal/77)*100)}%`;
                
                // Show student data and update schedule
                document.getElementById('studentDataContainer').classList.remove('hidden');
                initializeWeeklySchedule(studentData);
            } else {
                document.getElementById('studentDataContainer').classList.add('hidden');
            }
        }

        // Initialize the weekly schedule
        function initializeWeeklySchedule(studentData = null) {
            const scheduleContainer = document.getElementById('weeklySchedule');
            scheduleContainer.innerHTML = '';
            
            const progressData = studentData || currentProgress;

            weekDays.forEach((day, index) => {
                const isCompleted = progressData[index] >= dailyTargets[index];
                const isToday = index === 4; // Thursday is today for demo
                
                const dayElement = document.createElement('div');
                dayElement.className = `border rounded-lg p-4 ${isToday ? 'border-blue-500 bg-blue-50' : 'border-gray-200'} ${isCompleted ? 'bg-green-50' : ''}`;
                
                dayElement.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="text-lg font-semibold ${isToday ? 'text-blue-600' : 'text-gray-700'}">${day}</div>
                            ${isToday ? '<span class="bg-blue-500 text-white px-2 py-1 rounded-full text-xs">Hari Ini</span>' : ''}
                            ${isCompleted ? '<span class="text-green-500 text-xl">âœ…</span>' : ''}
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold ${isCompleted ? 'text-green-600' : 'text-gray-600'}">
                                ${progressData[index]}/${dailyTargets[index]}
                            </div>
                            <div class="text-sm text-gray-500">Muka Surat</div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="bg-gray-200 rounded-full h-2">
                            <div class="bg-gradient-to-r from-green-400 to-blue-500 h-2 rounded-full transition-all duration-500" 
                                 style="width: ${(progressData[index] / dailyTargets[index]) * 100}%"></div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex space-x-2">
                            <input type="number" placeholder="Juzuk" class="w-16 p-1 border rounded text-sm" ${isCompleted ? 'disabled' : ''}>
                            <input type="number" placeholder="Muka Surat" class="w-20 p-1 border rounded text-sm" ${isCompleted ? 'disabled' : ''}>
                        </div>
                        ${!isCompleted && isToday && selectedStudentIndex !== null ? `
                            <button onclick="markComplete(${index})" class="bg-green-500 text-white px-3 py-1 rounded-lg hover:bg-green-600 transition-colors text-sm">
                                Tandakan Selesai
                            </button>
                        ` : ''}
                    </div>
                    
                    <div class="mt-3">
                        <textarea placeholder="Catatan hari ini..." class="w-full p-2 border rounded text-sm" rows="2" ${isCompleted ? 'disabled' : ''}></textarea>
                    </div>
                    
                    ${comments[day] ? `
                        <div class="mt-3 space-y-1">
                            ${comments[day].map(comment => `
                                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-2 text-sm">
                                    ğŸ’¬ ${comment}
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${selectedStudentIndex !== null && window.studentComments && window.studentComments[selectedStudentIndex] ? `
                        <div class="mt-3 space-y-1">
                            ${window.studentComments[selectedStudentIndex].map(comment => `
                                <div class="bg-blue-50 border-l-4 border-blue-400 p-2 text-sm">
                                    ğŸ’¬ ${comment.text} <br>
                                    <span class="text-xs text-gray-500">${comment.author} - ${comment.date} ${comment.time}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${selectedStudentIndex !== null && window.confirmedReadings && window.confirmedReadings[selectedStudentIndex] && isToday ? `
                        <div class="mt-3">
                            <div class="bg-green-50 border-l-4 border-green-400 p-2 text-sm">
                                âœ… Bacaan disahkan oleh ${window.confirmedReadings[selectedStudentIndex].confirmedBy} 
                                pada ${window.confirmedReadings[selectedStudentIndex].date}
                            </div>
                        </div>
                    ` : ''}
                `;
                
                scheduleContainer.appendChild(dayElement);
            });
        }

        // Switch between different views
        function switchView(view) {
            // Hide all views
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('muridView').classList.add('hidden');
            document.getElementById('ibubapaView').classList.add('hidden');
            document.getElementById('guruView').classList.add('hidden');
            document.getElementById('gurubesarView').classList.add('hidden');
            
            // Show selected view
            document.getElementById(view + 'View').classList.remove('hidden');
            
            // Update button states
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('bg-white', 'bg-opacity-30', 'bg-opacity-40');
                btn.classList.add('bg-opacity-20');
            });
            
            if (view === 'dashboard') {
                document.getElementById(view + 'Btn').classList.remove('bg-opacity-20');
                document.getElementById(view + 'Btn').classList.add('bg-opacity-40');
            } else {
                document.getElementById(view + 'Btn').classList.remove('bg-opacity-20');
                document.getElementById(view + 'Btn').classList.add('bg-opacity-30');
            }
            
            // Load dashboard data when switching to dashboard
            if (view === 'dashboard') {
                loadDashboardData();
            }
            
            // Load headmaster data when switching to headmaster view
            if (view === 'gurubesar') {
                loadHeadmasterData();
            }
        }

        // Headmaster data storage
        window.headmasterComments = [
            {
                title: "Ulasan Prestasi Disember 2024",
                content: "Alhamdulillah, pencapaian kelas 6 Aktif menunjukkan peningkatan yang memberangsangkan. Skor keseluruhan 87% adalah antara yang terbaik dalam sekolah. Sistem DeMas telah membantu meningkatkan keterlibatan ibu bapa dan pemantauan harian yang lebih sistematik.",
                justification: "Peningkatan 12% berbanding 6 bulan lalu menunjukkan keberkesanan pendekatan digital dan keterlibatan ibu bapa yang aktif.",
                date: "15 Disember 2024",
                time: "2:30 PM"
            }
        ];

        window.verificationRecords = [
            {
                title: "Pengesahan Semester 2/2024",
                period: "Januari - Jun 2024",
                score: 75,
                comment: "Sistem DeMas telah berjaya dilaksanakan dengan pencapaian keseluruhan 75%. Semua murid menunjukkan kemajuan yang positif dalam bacaan harian Al-Quran.",
                date: "30 Jun 2024",
                time: "4:45 PM",
                status: "DISAHKAN"
            }
        ];

        // Headmaster Functions
        function loadHeadmasterData() {
            // Calculate overall performance
            const totalStudents = students.length;
            const khatamCount = semesterProgress.filter(progress => progress >= khatamTarget).length;
            const certificateCount = monthlyProgress.filter(progress => progress >= monthlyTarget).length;
            const totalPerformance = studentProgress.reduce((sum, progress) => sum + Math.round((progress/77)*100), 0);
            const overallScore = Math.round(totalPerformance / totalStudents);
            
            // Update headmaster statistics
            document.getElementById('overallPerformanceScore').textContent = overallScore + '%';
            document.getElementById('headmasterKhatamCount').textContent = khatamCount;
            document.getElementById('headmasterCertificateCount').textContent = certificateCount;
            
            // Load performance breakdown table
            loadHeadmasterPerformanceTable();
            
            // Load comments
            loadHeadmasterComments();
        }

        function loadHeadmasterPerformanceTable() {
            const tableBody = document.getElementById('headmasterPerformanceTable');
            tableBody.innerHTML = '';
            
            // Calculate performance categories
            const totalStudents = students.length;
            const khatamCount = semesterProgress.filter(progress => progress >= khatamTarget).length;
            const certificateCount = monthlyProgress.filter(progress => progress >= monthlyTarget).length;
            
            let excellentCount = 0, goodCount = 0, averageCount = 0, needsAttentionCount = 0;
            
            studentProgress.forEach(progress => {
                const percentage = Math.round((progress/77)*100);
                if (percentage >= 90) excellentCount++;
                else if (percentage >= 70) goodCount++;
                else if (percentage >= 50) averageCount++;
                else needsAttentionCount++;
            });
            
            const categories = [
                {
                    name: 'KHATAM Achievers (604+ muka surat)',
                    count: khatamCount,
                    percentage: Math.round((khatamCount/totalStudents)*100),
                    target: 30,
                    status: khatamCount >= Math.round(totalStudents * 0.3) ? 'Mencapai Target' : 'Di Bawah Target',
                    statusClass: khatamCount >= Math.round(totalStudents * 0.3) ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                },
                {
                    name: 'Layak Sijil Bulanan (308+ muka surat)',
                    count: certificateCount,
                    percentage: Math.round((certificateCount/totalStudents)*100),
                    target: 50,
                    status: certificateCount >= Math.round(totalStudents * 0.5) ? 'Mencapai Target' : 'Di Bawah Target',
                    statusClass: certificateCount >= Math.round(totalStudents * 0.5) ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                },
                {
                    name: 'Prestasi Cemerlang (90%+ mingguan)',
                    count: excellentCount,
                    percentage: Math.round((excellentCount/totalStudents)*100),
                    target: 40,
                    status: excellentCount >= Math.round(totalStudents * 0.4) ? 'Mencapai Target' : 'Di Bawah Target',
                    statusClass: excellentCount >= Math.round(totalStudents * 0.4) ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                },
                {
                    name: 'Prestasi Baik (70-89% mingguan)',
                    count: goodCount,
                    percentage: Math.round((goodCount/totalStudents)*100),
                    target: 40,
                    status: goodCount >= Math.round(totalStudents * 0.4) ? 'Mencapai Target' : 'Di Bawah Target',
                    statusClass: goodCount >= Math.round(totalStudents * 0.4) ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'
                },
                {
                    name: 'Perlu Perhatian (<50% mingguan)',
                    count: needsAttentionCount,
                    percentage: Math.round((needsAttentionCount/totalStudents)*100),
                    target: 10,
                    status: needsAttentionCount <= Math.round(totalStudents * 0.1) ? 'Dalam Kawalan' : 'Perlu Tindakan',
                    statusClass: needsAttentionCount <= Math.round(totalStudents * 0.1) ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                }
            ];
            
            categories.forEach(category => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-3 font-medium">${category.name}</td>
                    <td class="border border-gray-300 p-3 text-center font-bold">${category.count}/${totalStudents}</td>
                    <td class="border border-gray-300 p-3 text-center">
                        <div class="flex items-center justify-center space-x-2">
                            <span class="font-bold">${category.percentage}%</span>
                            <div class="w-16 bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: ${category.percentage}%"></div>
                            </div>
                        </div>
                    </td>
                    <td class="border border-gray-300 p-3 text-center">${category.target}%</td>
                    <td class="border border-gray-300 p-3 text-center">
                        <span class="${category.statusClass} px-2 py-1 rounded-full text-xs font-medium">${category.status}</span>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function loadHeadmasterComments() {
            const commentsContainer = document.getElementById('currentHeadmasterComments');
            commentsContainer.innerHTML = '';
            
            window.headmasterComments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = 'bg-white p-4 rounded-lg border-l-4 border-blue-400 shadow-sm';
                commentElement.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-semibold text-blue-800">${comment.title}</span>
                        <span class="text-xs text-gray-500">${comment.date}, ${comment.time}</span>
                    </div>
                    <p class="text-gray-700 mb-2">${comment.content}</p>
                    <div class="text-sm text-blue-600 font-medium">Justifikasi: ${comment.justification}</div>
                `;
                commentsContainer.appendChild(commentElement);
            });
        }

        function addHeadmasterComment() {
            const title = document.getElementById('headmasterCommentTitle').value.trim();
            const content = document.getElementById('headmasterCommentText').value.trim();
            
            if (!title || !content) {
                alert('Sila lengkapkan tajuk dan ulasan');
                return;
            }
            
            const now = new Date();
            const newComment = {
                title: title,
                content: content,
                justification: "Ulasan berdasarkan analisis prestasi terkini dan trend pencapaian murid.",
                date: now.toLocaleDateString('ms-MY'),
                time: now.toLocaleTimeString('ms-MY', {hour: '2-digit', minute: '2-digit'})
            };
            
            window.headmasterComments.unshift(newComment);
            
            // Clear form
            document.getElementById('headmasterCommentTitle').value = '';
            document.getElementById('headmasterCommentText').value = '';
            
            // Reload comments
            loadHeadmasterComments();
            
            // Show success message
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successMessage').textContent = 
                `Ulasan "${title}" telah berjaya disimpan! ğŸ’¬âœ…`;
        }

        function verifyPeriod() {
            const comment = document.getElementById('verificationComment').value.trim();
            
            if (!comment) {
                alert('Sila masukkan ulasan pengesahan');
                return;
            }
            
            const now = new Date();
            const overallScore = Math.round(studentProgress.reduce((sum, progress) => sum + Math.round((progress/77)*100), 0) / students.length);
            
            const newVerification = {
                title: "Pengesahan Semester 1/2025",
                period: "Julai - Disember 2024",
                score: overallScore,
                comment: comment,
                date: now.toLocaleDateString('ms-MY'),
                time: now.toLocaleTimeString('ms-MY', {hour: '2-digit', minute: '2-digit'}),
                status: "DISAHKAN"
            };
            
            window.verificationRecords.unshift(newVerification);
            
            // Update verification history display
            const historyContainer = document.getElementById('verificationHistory');
            const newVerificationElement = document.createElement('div');
            newVerificationElement.className = 'bg-white p-4 rounded-lg border-l-4 border-green-400 shadow-sm';
            newVerificationElement.innerHTML = `
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center space-x-2">
                        <span class="text-2xl">âœ…</span>
                        <span class="font-semibold text-green-800">${newVerification.title}</span>
                    </div>
                    <span class="text-xs text-gray-500">${newVerification.date}, ${newVerification.time}</span>
                </div>
                <p class="text-gray-700 mb-2">${newVerification.comment}</p>
                <div class="text-sm text-green-600 font-medium">Status: ${newVerification.status} - Tempoh: ${newVerification.period} - Skor: ${newVerification.score}%</div>
            `;
            
            historyContainer.insertBefore(newVerificationElement, historyContainer.firstChild);
            
            // Clear form
            document.getElementById('verificationComment').value = '';
            
            // Show success message
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successMessage').textContent = 
                `Pengesahan tempoh 6 bulan telah berjaya disimpan! âœ…ğŸ“‹ Skor pencapaian: ${overallScore}% | Tarikh: ${newVerification.date} ${newVerification.time}`;
        }

        function previewVerificationReport() {
            const overallScore = Math.round(studentProgress.reduce((sum, progress) => sum + Math.round((progress/77)*100), 0) / students.length);
            const khatamCount = semesterProgress.filter(progress => progress >= khatamTarget).length;
            const certificateCount = monthlyProgress.filter(progress => progress >= monthlyTarget).length;
            
            let reportContent = `LAPORAN PENGESAHAN 6 BULAN\n`;
            reportContent += `Tempoh: Julai - Disember 2024\n`;
            reportContent += `Kelas: 6 Aktif\n\n`;
            reportContent += `RINGKASAN PRESTASI:\n`;
            reportContent += `- Skor Keseluruhan: ${overallScore}%\n`;
            reportContent += `- Jumlah Murid: ${students.length}\n`;
            reportContent += `- KHATAM Achievers: ${khatamCount} murid\n`;
            reportContent += `- Layak Sijil: ${certificateCount} murid\n`;
            reportContent += `- Peningkatan: +12% berbanding tempoh sebelumnya\n\n`;
            reportContent += `STATUS: MENUNGGU PENGESAHAN GURU BESAR\n`;
            reportContent += `Tarikh Pratonton: ${new Date().toLocaleDateString('ms-MY')}`;
            
            alert(reportContent);
        }

        // Mark daily reading as complete
        function markComplete(dayIndex) {
            if (selectedStudentIndex !== null) {
                studentWeeklyData[selectedStudentIndex][dayIndex] = dailyTargets[dayIndex];
                
                // Update student progress
                const newTotal = studentWeeklyData[selectedStudentIndex].reduce((a, b) => a + b, 0);
                studentProgress[selectedStudentIndex] = newTotal;
                
                // Show success modal
                document.getElementById('successModal').classList.remove('hidden');
                
                // Reload student data to reflect changes
                loadSelectedStudent();
            }
        }

        // Update progress bar
        function updateProgressBar() {
            const totalTarget = dailyTargets.reduce((a, b) => a + b, 0);
            const totalProgress = currentProgress.reduce((a, b) => a + b, 0);
            const percentage = Math.round((totalProgress / totalTarget) * 100);
            
            document.getElementById('weeklyProgressBar').style.width = percentage + '%';
        }

        // Update today's progress
        function updateTodayProgress() {
            const todayIndex = 4; // Thursday for demo
            document.getElementById('todayProgress').textContent = 
                `${currentProgress[todayIndex]}/${dailyTargets[todayIndex]}`;
        }

        // Close success modal
        function closeModal() {
            document.getElementById('successModal').classList.add('hidden');
        }

        // Parent ID verification functions
        function validateICInput(event) {
            const char = String.fromCharCode(event.which);
            // Allow numbers, dash, and backspace
            if (!/[0-9\-]/.test(char) && event.which !== 8) {
                event.preventDefault();
                return false;
            }
            return true;
        }

        function formatICNumber(input) {
            let value = input.value.replace(/[^\d]/g, ''); // Remove non-digits
            
            // Format as YYMMDD-PP-XXXX
            if (value.length >= 6) {
                value = value.substring(0, 6) + '-' + value.substring(6);
            }
            if (value.length >= 9) {
                value = value.substring(0, 9) + '-' + value.substring(9, 13);
            }
            
            input.value = value;
        }

        function verifyParentID() {
            const inputID = document.getElementById('parentIDInput').value.trim();
            
            if (!inputID) {
                alert('Sila masukkan No. Kad Pengenalan anda');
                return;
            }
            
            // Validate IC format
            const icPattern = /^\d{6}-\d{2}-\d{4}$/;
            if (!icPattern.test(inputID)) {
                alert('Format No. Kad Pengenalan tidak sah. Sila gunakan format: YYMMDD-PP-XXXX');
                return;
            }
            
            // Find matching student
            let foundStudentIndex = null;
            for (const [studentIndex, parentID] of Object.entries(parentIDs)) {
                if (parentID === inputID) {
                    foundStudentIndex = parseInt(studentIndex);
                    break;
                }
            }
            
            if (foundStudentIndex !== null) {
                // Successful verification
                currentParentID = inputID;
                authorizedStudentIndex = foundStudentIndex;
                
                const studentName = students[foundStudentIndex];
                
                // Hide login section and show access status
                document.getElementById('parentLoginSection').classList.add('hidden');
                document.getElementById('parentAccessStatus').classList.remove('hidden');
                document.getElementById('parentStudentSection').classList.remove('hidden');
                
                // Update authorized parent info
                document.getElementById('authorizedParentInfo').textContent = 
                    `Selamat datang! Anda kini boleh mengakses data bacaan ${studentName}.`;
                
                // Update child info
                document.getElementById('childName').textContent = studentName;
                document.getElementById('childInitial').textContent = studentName.charAt(0).toUpperCase();
                
                // Show success message
                document.getElementById('successModal').classList.remove('hidden');
                document.getElementById('successMessage').textContent = 
                    `Identiti berjaya disahkan! Selamat datang, ibu bapa ${studentName}. ğŸ”âœ…`;
                
            } else {
                // Failed verification
                alert('No. Kad Pengenalan tidak dijumpai dalam sistem. Sila pastikan anda memasukkan No. IC yang betul atau hubungi pihak sekolah untuk bantuan.');
                
                // Clear input
                document.getElementById('parentIDInput').value = '';
            }
        }

        function showParentIDDemo() {
            document.getElementById('parentIDDemoModal').classList.remove('hidden');
        }

        function closeParentIDDemo() {
            document.getElementById('parentIDDemoModal').classList.add('hidden');
        }

        function logoutParent() {
            // Reset parent session
            currentParentID = null;
            authorizedStudentIndex = null;
            
            // Clear input
            document.getElementById('parentIDInput').value = '';
            
            // Hide student details if shown
            document.getElementById('parentStudentDetails').classList.add('hidden');
            
            // Show login section and hide access status
            document.getElementById('parentLoginSection').classList.remove('hidden');
            document.getElementById('parentAccessStatus').classList.add('hidden');
            document.getElementById('parentStudentSection').classList.add('hidden');
            
            // Show logout message
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successMessage').textContent = 
                'Anda telah berjaya log keluar dari sistem. Terima kasih! ğŸšªğŸ‘‹';
        }

        // Parent functions
        function loadStudentDataForParent() {
            // Check if parent is authorized
            if (authorizedStudentIndex === null) {
                alert('Sila sahkan identiti anda terlebih dahulu');
                return;
            }
            
            const studentIndex = authorizedStudentIndex;
            
            if (studentIndex !== '') {
                const studentName = students[studentIndex];
                
                document.getElementById('parentSelectedStudent').textContent = studentName;
                
                // Create day selector
                createParentDaySelector(studentIndex);
                
                // Load data for selected day
                loadParentDayData(studentIndex, selectedDayIndex);
                
                // Update status based on confirmation
                const statusElement = document.getElementById('parentStudentStatus');
                if (window.confirmedReadings && window.confirmedReadings[studentIndex]) {
                    statusElement.textContent = 'Disahkan';
                    statusElement.className = 'bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm';
                } else {
                    statusElement.textContent = 'Aktif';
                    statusElement.className = 'bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm';
                }
                
                // Load data history
                loadParentDataHistory(studentIndex);
                
                document.getElementById('parentStudentDetails').classList.remove('hidden');
            } else {
                document.getElementById('parentStudentDetails').classList.add('hidden');
            }
        }

        function createParentDaySelector(studentIndex) {
            const daySelector = document.getElementById('parentDaySelector');
            daySelector.innerHTML = '';
            
            const today = new Date();
            const currentHour = today.getHours();
            const currentDay = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
            const currentDayIndex = currentDay === 0 ? 6 : currentDay - 1; // Convert to our array index (0 = Monday)
            
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay() + 1); // Monday
            
            weekDays.forEach((day, index) => {
                const dayDate = new Date(startOfWeek);
                dayDate.setDate(startOfWeek.getDate() + index);
                
                const isToday = index === currentDayIndex;
                const isPastDay = index < currentDayIndex || (index === currentDayIndex && currentHour >= 24);
                const isFutureDay = index > currentDayIndex;
                const hasData = window.studentDataHistory[studentIndex][index].length > 0;
                const isConfirmed = window.confirmedReadings && window.confirmedReadings[studentIndex] && 
                                 window.confirmedReadings[studentIndex].dayIndex === index;
                
                // Check if day is past due (after midnight)
                const isPastDue = isPastDay && !isConfirmed && !hasData;
                const canEdit = isToday && currentHour < 24; // Can only edit today before midnight
                
                let statusIcon = '';
                let statusClass = '';
                
                if (isConfirmed) {
                    statusIcon = '<div class="text-xs text-green-500">âœ… Disahkan</div>';
                    statusClass = 'border-green-300 bg-green-50';
                } else if (hasData && !isPastDue) {
                    statusIcon = '<div class="text-xs text-blue-500">ğŸ“ Data Diisi</div>';
                    statusClass = 'border-blue-300 bg-blue-50';
                } else if (isPastDue) {
                    statusIcon = '<div class="text-xs text-red-500">âŒ Missing</div>';
                    statusClass = 'border-red-300 bg-red-50';
                } else if (isFutureDay) {
                    statusIcon = '<div class="text-xs text-gray-400">â³ Belum Tiba</div>';
                    statusClass = 'border-gray-200 bg-gray-50 opacity-50';
                }
                
                const dayElement = document.createElement('div');
                dayElement.className = `text-center p-2 rounded-lg border transition-all ${
                    selectedDayIndex === index ? 'border-blue-500 bg-blue-100' : statusClass
                } ${canEdit || hasData ? 'cursor-pointer hover:border-blue-300' : 'cursor-not-allowed'}
                ${isToday ? 'ring-2 ring-blue-300' : ''}`;
                
                // Calculate due time
                const dueDate = new Date(dayDate);
                dueDate.setHours(23, 59, 59, 999); // 11:59:59 PM
                const timeLeft = dueDate - today;
                const hoursLeft = Math.max(0, Math.floor(timeLeft / (1000 * 60 * 60)));
                const minutesLeft = Math.max(0, Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60)));
                
                dayElement.innerHTML = `
                    <div class="text-xs font-medium text-gray-600">${day}</div>
                    <div class="text-xs text-gray-500">${dayDate.getDate()}/${dayDate.getMonth() + 1}</div>
                    ${statusIcon}
                    ${isToday && !isConfirmed ? `<div class="text-xs text-orange-600 font-bold">â° ${hoursLeft}j ${minutesLeft}m</div>` : ''}
                    ${isToday && !isConfirmed ? '<div class="text-xs text-red-500">Due: 12:00 AM</div>' : ''}
                `;
                
                if (canEdit || hasData) {
                    dayElement.onclick = () => selectParentDay(studentIndex, index);
                }
                
                daySelector.appendChild(dayElement);
            });
        }

        function selectParentDay(studentIndex, dayIndex) {
            selectedDayIndex = dayIndex;
            createParentDaySelector(studentIndex);
            loadParentDayData(studentIndex, dayIndex);
        }

        function loadParentDayData(studentIndex, dayIndex) {
            const dayData = window.studentDailyData[studentIndex][dayIndex];
            const today = new Date();
            const currentHour = today.getHours();
            const currentDay = today.getDay();
            const currentDayIndex = currentDay === 0 ? 6 : currentDay - 1;
            
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay() + 1);
            const selectedDate = new Date(startOfWeek);
            selectedDate.setDate(startOfWeek.getDate() + dayIndex);
            
            // Check if editing is allowed
            const isToday = dayIndex === currentDayIndex;
            const isPastDue = dayIndex < currentDayIndex || (dayIndex === currentDayIndex && currentHour >= 24);
            const isFutureDay = dayIndex > currentDayIndex;
            const isConfirmed = window.confirmedReadings && window.confirmedReadings[studentIndex] && 
                             window.confirmedReadings[studentIndex].dayIndex === dayIndex;
            
            const canEdit = isToday && currentHour < 24 && !isConfirmed;
            
            // Calculate due time for today
            let dueTimeText = '';
            if (isToday && !isConfirmed) {
                const dueDate = new Date(selectedDate);
                dueDate.setHours(23, 59, 59, 999);
                const timeLeft = dueDate - today;
                const hoursLeft = Math.max(0, Math.floor(timeLeft / (1000 * 60 * 60)));
                const minutesLeft = Math.max(0, Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60)));
                
                if (timeLeft > 0) {
                    dueTimeText = ` - â° Masa Tinggal: ${hoursLeft} jam ${minutesLeft} minit`;
                } else {
                    dueTimeText = ' - âŒ TAMAT TEMPOH';
                }
            }
            
            // Update day display with status
            let statusText = '';
            if (isConfirmed) {
                statusText = ' âœ… DISAHKAN';
            } else if (isPastDue && !window.studentDataHistory[studentIndex][dayIndex].length) {
                statusText = ' âŒ MISSING - Terlepas Pengesahan';
            } else if (isFutureDay) {
                statusText = ' â³ Belum Tiba Masanya';
            }
            
            document.getElementById('parentSelectedDay').textContent = 
                `Hari: ${weekDays[dayIndex]}, ${selectedDate.getDate()} ${getMonthName(selectedDate.getMonth())} ${selectedDate.getFullYear()}${statusText}${dueTimeText}`;
            
            // Load existing data
            document.getElementById('parentEditPages').value = dayData.pages || 0;
            document.getElementById('parentEditJuzuk').value = dayData.juzuk || 1;
            document.getElementById('parentEditNotes').value = dayData.notes || '';
            
            // Enable/disable form fields based on due time
            const formElements = [
                document.getElementById('parentEditPages'),
                document.getElementById('parentEditJuzuk'),
                document.getElementById('parentEditNotes')
            ];
            
            formElements.forEach(element => {
                element.disabled = !canEdit;
                if (!canEdit) {
                    element.classList.add('bg-gray-100', 'cursor-not-allowed');
                } else {
                    element.classList.remove('bg-gray-100', 'cursor-not-allowed');
                }
            });
            
            // Show/hide action buttons based on due time
            updateParentActionButtons(canEdit, isConfirmed, isPastDue, isFutureDay);
        }

        function getMonthName(monthIndex) {
            const months = ['Januari', 'Februari', 'Mac', 'April', 'Mei', 'Jun', 
                          'Julai', 'Ogos', 'September', 'Oktober', 'November', 'Disember'];
            return months[monthIndex];
        }

        function updateParentActionButtons(canEdit, isConfirmed, isPastDue, isFutureDay) {
            const saveBtn = document.getElementById('saveDataBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            const commentBtn = document.getElementById('commentBtn');
            const warningDiv = document.getElementById('dueTimeWarning');
            const warningMsg = document.getElementById('warningMessage');
            
            // Reset button states
            [saveBtn, confirmBtn, commentBtn].forEach(btn => {
                btn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                btn.disabled = false;
            });
            
            if (!canEdit) {
                // Disable save and confirm buttons if can't edit
                saveBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                confirmBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                saveBtn.disabled = true;
                confirmBtn.disabled = true;
                
                // Show appropriate warning
                warningDiv.classList.remove('hidden');
                
                if (isConfirmed) {
                    warningMsg.textContent = 'Bacaan untuk hari ini telah disahkan. Tiada perubahan boleh dibuat.';
                } else if (isPastDue) {
                    warningMsg.textContent = 'Masa untuk pengesahan telah tamat. Pengesahan hanya boleh dibuat pada hari yang sama sebelum jam 12:00 malam.';
                } else if (isFutureDay) {
                    warningMsg.textContent = 'Pengesahan hanya boleh dibuat pada hari yang berkenaan.';
                }
            } else {
                // Hide warning if can edit
                warningDiv.classList.add('hidden');
                
                // Update button text based on status
                if (isConfirmed) {
                    confirmBtn.textContent = 'âœ… Telah Disahkan';
                    confirmBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                    confirmBtn.disabled = true;
                } else {
                    confirmBtn.textContent = 'âœ… Sahkan Bacaan';
                    confirmBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    confirmBtn.disabled = false;
                }
            }
        }

        function loadParentDataHistory(studentIndex) {
            const historyList = document.getElementById('parentHistoryList');
            historyList.innerHTML = '';
            
            let hasHistory = false;
            
            // Show history for all days
            weekDays.forEach((day, dayIndex) => {
                const dayHistory = window.studentDataHistory[studentIndex][dayIndex];
                if (dayHistory.length > 0) {
                    hasHistory = true;
                    
                    dayHistory.forEach(entry => {
                        const historyItem = document.createElement('div');
                        historyItem.className = 'bg-gray-50 rounded-lg p-3 border-l-4 border-blue-400';
                        historyItem.innerHTML = `
                            <div class="flex items-center justify-between mb-1">
                                <span class="font-medium text-gray-800">${day}</span>
                                <span class="text-xs text-gray-500">${entry.date} ${entry.time}</span>
                            </div>
                            <div class="text-sm text-gray-700">
                                ğŸ“– ${entry.pages} muka surat | ğŸ“š Juzuk ${entry.juzuk}
                                ${entry.notes ? `<br>ğŸ’­ ${entry.notes}` : ''}
                            </div>
                            <div class="text-xs text-blue-600 mt-1">Dikemaskini oleh: ${entry.updatedBy}</div>
                        `;
                        historyList.appendChild(historyItem);
                    });
                }
            });
            
            if (!hasHistory) {
                historyList.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">Belum ada sejarah pengisian data</p>';
            }
        }

        function saveParentEdit() {
            // Check authorization
            if (authorizedStudentIndex === null) {
                alert('Sila sahkan identiti anda terlebih dahulu');
                return;
            }
            
            const studentIndex = authorizedStudentIndex;
            const pages = parseInt(document.getElementById('parentEditPages').value) || 0;
            const juzuk = parseInt(document.getElementById('parentEditJuzuk').value) || 1;
            const notes = document.getElementById('parentEditNotes').value;
            
            // Check if editing is allowed
            const today = new Date();
            const currentHour = today.getHours();
            const currentDay = today.getDay();
            const currentDayIndex = currentDay === 0 ? 6 : currentDay - 1;
            const isToday = selectedDayIndex === currentDayIndex;
            const canEdit = isToday && currentHour < 24;
            
            if (!canEdit) {
                alert('Pengesahan data hanya boleh dibuat pada hari yang sama sebelum jam 12:00 malam!');
                return;
            }
            
            if (studentIndex !== '' && pages >= 0) {
                const now = new Date();
                const dateStr = now.toLocaleDateString('ms-MY');
                const timeStr = now.toLocaleTimeString('ms-MY', {hour: '2-digit', minute: '2-digit'});
                
                // Update daily data
                window.studentDailyData[studentIndex][selectedDayIndex] = {
                    pages: pages,
                    juzuk: juzuk,
                    notes: notes,
                    lastUpdated: now,
                    updatedBy: 'Ibu Bapa'
                };
                
                // Add to history
                window.studentDataHistory[studentIndex][selectedDayIndex].push({
                    pages: pages,
                    juzuk: juzuk,
                    notes: notes,
                    date: dateStr,
                    time: timeStr,
                    updatedBy: 'Ibu Bapa',
                    action: 'Kemaskini Data'
                });
                
                // Update weekly data
                studentWeeklyData[studentIndex][selectedDayIndex] = pages;
                
                // Update today's reading if it's today
                if (selectedDayIndex === currentDayIndex) {
                    todayReading[studentIndex] = pages;
                }
                
                // Recalculate weekly total
                const newWeeklyTotal = studentWeeklyData[studentIndex].reduce((a, b) => a + b, 0);
                studentProgress[studentIndex] = newWeeklyTotal;
                
                // Update all displays
                updateTeacherTable();
                createParentDaySelector(studentIndex);
                loadParentDataHistory(studentIndex);
                
                // If student is currently selected in student view, refresh their data
                if (selectedStudentIndex == studentIndex) {
                    loadSelectedStudent();
                }
                
                // Show success message
                document.getElementById('successModal').classList.remove('hidden');
                document.getElementById('successMessage').textContent = 
                    `Data ${weekDays[selectedDayIndex]} untuk ${students[studentIndex]} telah disimpan! 
                    ğŸ“– ${pages} muka surat | ğŸ“š Juzuk ${juzuk}
                    ğŸ• ${dateStr} ${timeStr}`;
            }
        }

        function confirmReading() {
            // Check authorization
            if (authorizedStudentIndex === null) {
                alert('Sila sahkan identiti anda terlebih dahulu');
                return;
            }
            
            const studentIndex = authorizedStudentIndex;
            
            // Check if confirmation is allowed
            const today = new Date();
            const currentHour = today.getHours();
            const currentDay = today.getDay();
            const currentDayIndex = currentDay === 0 ? 6 : currentDay - 1;
            const isToday = selectedDayIndex === currentDayIndex;
            const canConfirm = isToday && currentHour < 24;
            
            if (!canConfirm) {
                alert('Pengesahan bacaan hanya boleh dibuat pada hari yang sama sebelum jam 12:00 malam!');
                return;
            }
            
            // Check if already confirmed
            if (window.confirmedReadings && window.confirmedReadings[studentIndex] && 
                window.confirmedReadings[studentIndex].dayIndex === selectedDayIndex) {
                alert('Bacaan untuk hari ini telah disahkan sebelum ini!');
                return;
            }
            
            if (studentIndex !== '') {
                const studentName = students[studentIndex];
                const dayData = window.studentDailyData[studentIndex][selectedDayIndex];
                const now = new Date();
                const dateStr = now.toLocaleDateString('ms-MY');
                const timeStr = now.toLocaleTimeString('ms-MY', {hour: '2-digit', minute: '2-digit'});
                
                // Mark selected day as confirmed
                if (!window.confirmedReadings) window.confirmedReadings = {};
                window.confirmedReadings[studentIndex] = {
                    date: dateStr,
                    time: timeStr,
                    day: weekDays[selectedDayIndex],
                    dayIndex: selectedDayIndex,
                    pages: dayData.pages,
                    confirmedBy: 'Ibu Bapa'
                };
                
                // Add confirmation to history
                window.studentDataHistory[studentIndex][selectedDayIndex].push({
                    pages: dayData.pages,
                    juzuk: dayData.juzuk,
                    notes: dayData.notes,
                    date: dateStr,
                    time: timeStr,
                    updatedBy: 'Ibu Bapa',
                    action: 'Sahkan Bacaan'
                });
                
                // Update displays
                updateTeacherTable();
                loadStudentDataForParent();
                
                if (selectedStudentIndex == studentIndex) {
                    loadSelectedStudent();
                }
                
                // Show confirmation
                document.getElementById('successModal').classList.remove('hidden');
                document.getElementById('successMessage').textContent = 
                    `Bacaan ${weekDays[selectedDayIndex]} untuk ${studentName} telah disahkan! âœ… 
                    ğŸ“– ${dayData.pages} muka surat | ğŸ• ${dateStr} ${timeStr}`;
            }
        }

        function addComment() {
            // Check authorization
            if (authorizedStudentIndex === null) {
                alert('Sila sahkan identiti anda terlebih dahulu');
                return;
            }
            
            window.currentCommentStudentIndex = authorizedStudentIndex;
            document.getElementById('commentModal').classList.remove('hidden');
        }

        // Teacher functions
        function loadStudentDataForTeacher() {
            const select = document.getElementById('teacherStudentSelect');
            const studentIndex = select.value;
            
            if (studentIndex !== '') {
                const pages = todayReading[studentIndex];
                document.getElementById('teacherEditPages').value = pages;
            }
        }

        function saveTeacherEdit() {
            const select = document.getElementById('teacherStudentSelect');
            const studentIndex = select.value;
            const pages = document.getElementById('teacherEditPages').value;
            
            if (studentIndex !== '' && pages) {
                todayReading[studentIndex] = parseInt(pages);
                studentProgress[studentIndex] = Math.min(77, studentProgress[studentIndex] + parseInt(pages) - todayReading[studentIndex]);
                alert(`Data bacaan ${students[studentIndex]} telah dikemaskini! ğŸ“š`);
                updateTeacherTable();
            }
        }

        function updateTeacherTable() {
            const tableBody = document.getElementById('teacherStudentTable');
            tableBody.innerHTML = '';
            
            let trophyCount = 0;
            let certificateEligibleCount = 0;
            let targetAchievedCount = 0;
            let needsAttentionCount = 0;
            let missingCount = 0;
            let khatamAchieversCount = 0;
            
            const today = new Date();
            const currentDay = today.getDay();
            const currentDayIndex = currentDay === 0 ? 6 : currentDay - 1;
            
            students.forEach((student, index) => {
                const progress = studentProgress[index];
                const percentage = Math.round((progress / 77) * 100);
                const isTargetAchieved = progress >= 77;
                const monthlyPages = monthlyProgress[index];
                const isCertificateEligible = monthlyPages >= monthlyTarget;
                const semesterTotal = semesterProgress[index];
                const isKhatam = semesterTotal >= khatamTarget;
                
                // Check for missing confirmations (past days without confirmation)
                let hasMissing = false;
                for (let dayIndex = 0; dayIndex < currentDayIndex; dayIndex++) {
                    const isConfirmed = window.confirmedReadings && window.confirmedReadings[index] && 
                                     window.confirmedReadings[index].dayIndex === dayIndex;
                    const hasData = window.studentDataHistory[index][dayIndex].length > 0;
                    
                    if (!isConfirmed && !hasData) {
                        hasMissing = true;
                        missingCount++;
                        break;
                    }
                }
                
                let status, statusClass;
                
                // Count statistics
                if (isTargetAchieved) {
                    trophyCount++;
                }
                
                if (isCertificateEligible) {
                    certificateEligibleCount++;
                }
                
                if (isKhatam) {
                    khatamAchieversCount++;
                }
                
                if (isKhatam) {
                    status = 'KHATAM';
                    statusClass = 'bg-gradient-to-r from-purple-100 to-pink-100 text-purple-800 border border-purple-300';
                } else if (hasMissing) {
                    status = 'Missing';
                    statusClass = 'bg-red-100 text-red-800';
                    needsAttentionCount++;
                } else if (percentage >= 70) {
                    status = 'Cemerlang';
                    statusClass = 'bg-green-100 text-green-800';
                    targetAchievedCount++;
                } else if (percentage >= 50) {
                    status = 'Baik';
                    statusClass = 'bg-blue-100 text-blue-800';
                } else {
                    status = 'Perlu Perhatian';
                    statusClass = 'bg-orange-100 text-orange-800';
                    needsAttentionCount++;
                }
                
                const row = document.createElement('tr');
                row.className = isKhatam ? 'bg-gradient-to-r from-purple-50 to-pink-50 border-4 border-purple-400' : 
                               (isCertificateEligible ? 'bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300' : 
                               (isTargetAchieved ? 'bg-yellow-50' : (hasMissing ? 'bg-red-50' : '')));
                row.innerHTML = `
                    <td class="border border-gray-300 p-3">
                        <div class="flex items-center space-x-2">
                            <span class="${isKhatam ? 'font-bold text-purple-800' : (isCertificateEligible ? 'font-bold text-yellow-800' : '')}">${student}</span>
                            ${isKhatam ? '<span class="text-3xl animate-pulse">ğŸ†</span>' : ''}
                            ${isCertificateEligible && !isKhatam ? '<span class="text-2xl animate-pulse">ğŸ†</span>' : ''}
                            ${isTargetAchieved && !isCertificateEligible && !isKhatam ? '<span class="text-xl">â­</span>' : ''}
                            ${hasMissing && !isKhatam ? '<span class="text-lg text-red-500">âŒ</span>' : ''}
                        </div>
                        ${isKhatam ? '<div class="text-xs text-purple-800 font-bold mt-1 animate-pulse">ğŸ† KHATAM CHAMPION ğŸ†</div>' : ''}
                        ${isCertificateEligible && !isKhatam ? '<div class="text-xs text-yellow-700 font-semibold mt-1">LAYAK SIJIL BULANAN</div>' : ''}
                    </td>
                    <td class="border border-gray-300 p-3 text-center">
                        <div class="flex flex-col items-center space-y-1">
                            <div class="flex items-center space-x-2">
                                <span class="${isTargetAchieved ? 'font-bold text-green-600' : ''}">${progress}/77 (${percentage}%)</span>
                                ${isTargetAchieved ? '<span class="text-lg">âœ…</span>' : ''}
                            </div>
                            <div class="text-xs text-gray-600">
                                Bulanan: ${monthlyPages}/308 (${Math.round((monthlyPages/monthlyTarget)*100)}%)
                            </div>
                            ${isKhatam ? `<div class="text-xs text-purple-700 font-bold">Semester: ${semesterTotal}/604 âœ…</div>` : 
                             `<div class="text-xs text-gray-600">Semester: ${semesterTotal}/604 (${Math.round((semesterTotal/khatamTarget)*100)}%)</div>`}
                        </div>
                    </td>
                    <td class="border border-gray-300 p-3 text-center">
                        <div class="flex flex-col items-center space-y-1">
                            <span class="${statusClass} px-2 py-1 rounded-full text-sm font-bold">${status}</span>
                            ${isKhatam ? '<span class="bg-gradient-to-r from-purple-100 to-pink-100 text-purple-800 px-2 py-1 rounded-full text-xs font-bold border-2 border-purple-400 animate-pulse">ğŸ† KHATAM ACHIEVED ğŸ†</span>' : ''}
                            ${isCertificateEligible && !isKhatam ? '<span class="bg-gradient-to-r from-yellow-100 to-orange-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-bold border border-yellow-300">ğŸ† LAYAK SIJIL</span>' : ''}
                            ${isTargetAchieved && !isCertificateEligible && !isKhatam ? '<span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-bold">TARGET MINGGUAN</span>' : ''}
                            ${hasMissing && !isKhatam ? '<span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-bold">TERLEPAS PENGESAHAN</span>' : ''}
                        </div>
                    </td>
                    <td class="border border-gray-300 p-3 text-center">
                        <button onclick="viewStudentDetail(${index})" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 text-sm">Lihat Detail</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Update statistics display
            document.getElementById('totalStudents').textContent = students.length;
            document.getElementById('khatamAchieversCount').textContent = khatamAchieversCount;
            document.getElementById('certificateEligibleCount').textContent = certificateEligibleCount;
            document.getElementById('targetAchieved').textContent = targetAchievedCount;
            document.getElementById('needsAttention').textContent = needsAttentionCount + missingCount;
        }

        function viewStudentDetail(studentIndex) {
            const student = students[studentIndex];
            const progress = studentProgress[studentIndex];
            const today = todayReading[studentIndex];
            const weeklyData = studentWeeklyData[studentIndex];
            const percentage = Math.round((progress / 77) * 100);
            
            // Update modal content
            document.getElementById('detailStudentName').textContent = `Detail ${student}`;
            document.getElementById('detailStudentFullName').textContent = student;
            document.getElementById('detailStudentInitial').textContent = student.charAt(0).toUpperCase();
            
            // Update progress data
            document.getElementById('detailTodayPages').textContent = `${today}/11`;
            document.getElementById('detailWeekPages').textContent = `${progress}/77`;
            document.getElementById('detailPercentage').textContent = `${percentage}%`;
            document.getElementById('detailProgressText').textContent = `${progress} daripada 77 muka surat (${percentage}%)`;
            document.getElementById('detailProgressBar').style.width = `${percentage}%`;
            
            // Update stars
            let stars = '';
            let starCount = 0;
            if (percentage >= 90) { stars = 'â­â­â­â­â­'; starCount = 5; }
            else if (percentage >= 80) { stars = 'â­â­â­â­'; starCount = 4; }
            else if (percentage >= 70) { stars = 'â­â­â­'; starCount = 3; }
            else if (percentage >= 60) { stars = 'â­â­'; starCount = 2; }
            else { stars = 'â­'; starCount = 1; }
            
            document.getElementById('detailStars').textContent = stars;
            document.getElementById('detailStarText').textContent = `${starCount} Bintang`;
            
            // Update status
            let status, statusClass;
            if (percentage >= 70) {
                status = 'Cemerlang';
                statusClass = 'bg-green-100 text-green-800';
            } else if (percentage >= 50) {
                status = 'Baik';
                statusClass = 'bg-blue-100 text-blue-800';
            } else {
                status = 'Perlu Perhatian';
                statusClass = 'bg-red-100 text-red-800';
            }
            
            const statusElement = document.getElementById('detailOverallStatus');
            statusElement.textContent = status;
            statusElement.className = `px-3 py-1 rounded-full text-sm font-medium ${statusClass}`;
            
            // Calculate completed days and average
            const completedDays = weeklyData.filter(day => day >= 11).length;
            const totalPages = weeklyData.reduce((a, b) => a + b, 0);
            const average = (totalPages / 7).toFixed(1);
            
            document.getElementById('detailCompletedDays').textContent = `${completedDays}/7 hari`;
            document.getElementById('detailDailyAverage').textContent = `${average} muka surat`;
            
            // Update daily breakdown
            const dailyBreakdown = document.getElementById('detailDailyBreakdown');
            dailyBreakdown.innerHTML = '';
            
            weekDays.forEach((day, index) => {
                const dayPages = weeklyData[index];
                const isCompleted = dayPages >= 11;
                const isToday = index === 4;
                
                const dayElement = document.createElement('div');
                dayElement.className = `text-center p-2 rounded-lg border ${isToday ? 'border-blue-500 bg-blue-50' : 'border-gray-200'} ${isCompleted ? 'bg-green-50' : ''}`;
                dayElement.innerHTML = `
                    <div class="text-xs font-medium text-gray-600 mb-1">${day.substring(0, 3)}</div>
                    <div class="text-sm font-bold ${isCompleted ? 'text-green-600' : 'text-gray-600'}">${dayPages}/11</div>
                    ${isCompleted ? '<div class="text-xs text-green-500">âœ…</div>' : ''}
                    ${isToday ? '<div class="text-xs text-blue-500">Hari Ini</div>' : ''}
                `;
                dailyBreakdown.appendChild(dayElement);
            });
            
            // Store current student index for editing
            window.currentDetailStudentIndex = studentIndex;
            
            // Show modal
            document.getElementById('studentDetailModal').classList.remove('hidden');
        }

        function closeStudentDetailModal() {
            document.getElementById('studentDetailModal').classList.add('hidden');
        }

        function editStudentFromDetail() {
            if (window.currentDetailStudentIndex !== undefined) {
                // Switch to teacher view and pre-select the student
                switchView('guru');
                document.getElementById('teacherStudentSelect').value = window.currentDetailStudentIndex;
                loadStudentDataForTeacher();
                closeStudentDetailModal();
                
                // Scroll to edit section
                document.querySelector('#guruView .bg-gray-50').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function addStudentComment() {
            document.getElementById('commentModal').classList.remove('hidden');
        }

        function closeCommentModal() {
            document.getElementById('commentModal').classList.add('hidden');
            document.getElementById('commentText').value = '';
        }

        function saveComment() {
            const comment = document.getElementById('commentText').value;
            const studentIndex = window.currentCommentStudentIndex;
            
            if (comment.trim() && studentIndex !== undefined) {
                // Initialize comments storage
                if (!window.studentComments) window.studentComments = {};
                if (!window.studentComments[studentIndex]) window.studentComments[studentIndex] = [];
                
                // Add new comment with timestamp
                const newComment = {
                    text: comment.trim(),
                    date: new Date().toLocaleDateString('ms-MY'),
                    time: new Date().toLocaleTimeString('ms-MY', {hour: '2-digit', minute: '2-digit'}),
                    author: 'Ibu Bapa'
                };
                
                window.studentComments[studentIndex].push(newComment);
                
                // Update student view if this student is currently selected
                if (selectedStudentIndex == studentIndex) {
                    loadSelectedStudent();
                }
                
                // Show success message
                document.getElementById('successModal').classList.remove('hidden');
                document.getElementById('successMessage').textContent = 
                    `Ulasan untuk ${students[studentIndex]} telah disimpan! ğŸ’¬`;
                
                closeCommentModal();
            } else if (!comment.trim()) {
                alert('Sila masukkan ulasan terlebih dahulu');
            }
        }

        // Certificate Functions
        function checkCertificateEligibility() {
            const select = document.getElementById('certificateStudentSelect');
            const studentIndex = select.value;
            const statusDiv = document.getElementById('certificateStatus');
            const generateBtn = document.getElementById('generateCertBtn');
            const previewBtn = document.getElementById('previewCertBtn');
            
            if (studentIndex === '') {
                statusDiv.classList.add('hidden');
                generateBtn.disabled = true;
                previewBtn.disabled = true;
                return;
            }
            
            const studentName = students[studentIndex];
            const monthlyPages = monthlyProgress[studentIndex];
            const percentage = Math.round((monthlyPages / monthlyTarget) * 100);
            const isEligible = monthlyPages >= monthlyTarget;
            
            // Show status
            statusDiv.classList.remove('hidden');
            
            if (isEligible) {
                statusDiv.className = 'mb-4 p-3 rounded-lg border border-green-300 bg-green-50';
                document.getElementById('statusIcon').textContent = 'âœ…';
                document.getElementById('statusTitle').textContent = 'Layak Menerima Sijil!';
                document.getElementById('statusTitle').className = 'font-semibold text-green-800';
                document.getElementById('statusMessage').textContent = 
                    `${studentName} telah mencapai ${monthlyPages} muka surat (${percentage}%) daripada target ${monthlyTarget} muka surat.`;
                document.getElementById('statusMessage').className = 'text-sm text-green-700';
                
                generateBtn.disabled = false;
                previewBtn.disabled = false;
            } else {
                const shortfall = monthlyTarget - monthlyPages;
                statusDiv.className = 'mb-4 p-3 rounded-lg border border-red-300 bg-red-50';
                document.getElementById('statusIcon').textContent = 'âŒ';
                document.getElementById('statusTitle').textContent = 'Belum Layak Menerima Sijil';
                document.getElementById('statusTitle').className = 'font-semibold text-red-800';
                document.getElementById('statusMessage').textContent = 
                    `${studentName} baru mencapai ${monthlyPages} muka surat (${percentage}%). Perlu ${shortfall} muka surat lagi untuk mencapai target.`;
                document.getElementById('statusMessage').className = 'text-sm text-red-700';
                
                generateBtn.disabled = true;
                previewBtn.disabled = true;
            }
        }

        function previewCertificate() {
            const studentIndex = document.getElementById('certificateStudentSelect').value;
            const monthInput = document.getElementById('certificateMonth').value;
            
            if (studentIndex === '') {
                alert('Sila pilih murid terlebih dahulu');
                return;
            }
            
            const studentName = students[studentIndex];
            const monthlyPages = monthlyProgress[studentIndex];
            const percentage = Math.round((monthlyPages / monthlyTarget) * 100);
            const today = new Date();
            
            // Convert month input to readable format
            const [year, month] = monthInput.split('-');
            const monthNames = [
                'Januari', 'Februari', 'Mac', 'April', 'Mei', 'Jun',
                'Julai', 'Ogos', 'September', 'Oktober', 'November', 'Disember'
            ];
            const monthName = monthNames[parseInt(month) - 1];
            const displayMonth = `${monthName} ${year}`;
            
            // Update certificate content
            document.getElementById('certificateStudentName').textContent = studentName.toUpperCase();
            document.getElementById('certificatePages').textContent = monthlyPages;
            document.getElementById('certificatePercentage').textContent = percentage + '%';
            document.getElementById('certificateMonthDisplay').textContent = displayMonth;
            document.getElementById('certificateDate').textContent = today.toLocaleDateString('ms-MY');
            
            // Show preview modal
            document.getElementById('certificatePreviewModal').classList.remove('hidden');
        }

        function closeCertificatePreview() {
            document.getElementById('certificatePreviewModal').classList.add('hidden');
        }

        function generateCertificate() {
            const studentIndex = document.getElementById('certificateStudentSelect').value;
            
            if (studentIndex === '') {
                alert('Sila pilih murid terlebih dahulu');
                return;
            }
            
            // Show preview first, then allow download
            previewCertificate();
        }

        function downloadCertificatePDF() {
            const studentIndex = document.getElementById('certificateStudentSelect').value;
            const studentName = students[studentIndex];
            const monthInput = document.getElementById('certificateMonth').value;
            const monthlyPages = monthlyProgress[studentIndex];
            const percentage = Math.round((monthlyPages / monthlyTarget) * 100);
            const today = new Date();
            
            // Convert month input to readable format
            const [year, month] = monthInput.split('-');
            const monthNames = [
                'Januari', 'Februari', 'Mac', 'April', 'Mei', 'Jun',
                'Julai', 'Ogos', 'September', 'Oktober', 'November', 'Disember'
            ];
            const monthName = monthNames[parseInt(month) - 1];
            const displayMonth = `${monthName} ${year}`;
            
            // Create new jsPDF instance
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'landscape',
                unit: 'mm',
                format: 'a4'
            });
            
            // Set font
            doc.setFont('helvetica');
            
            // Certificate background and border
            doc.setFillColor(255, 248, 220); // Light yellow background
            doc.rect(10, 10, 277, 190, 'F');
            
            // Golden border
            doc.setDrawColor(255, 193, 7);
            doc.setLineWidth(3);
            doc.rect(15, 15, 267, 180);
            
            // Inner border
            doc.setLineWidth(1);
            doc.rect(20, 20, 257, 170);
            
            // Title
            doc.setFontSize(32);
            doc.setTextColor(255, 193, 7);
            doc.text('SIJIL PENGHARGAAN', 148.5, 45, { align: 'center' });
            
            // Subtitle
            doc.setFontSize(14);
            doc.setTextColor(100, 100, 100);
            doc.text('Sistem Semakan Bacaan Harian (DeMas)', 148.5, 55, { align: 'center' });
            
            // Award text
            doc.setFontSize(16);
            doc.setTextColor(50, 50, 50);
            doc.text('Sijil ini diberikan kepada', 148.5, 75, { align: 'center' });
            
            // Student name
            doc.setFontSize(28);
            doc.setTextColor(37, 99, 235); // Blue color
            doc.text(studentName.toUpperCase(), 148.5, 95, { align: 'center' });
            
            // Class
            doc.setFontSize(14);
            doc.setTextColor(100, 100, 100);
            doc.text('Kelas 6 Aktif', 148.5, 105, { align: 'center' });
            
            // Achievement text
            doc.setFontSize(16);
            doc.setTextColor(50, 50, 50);
            doc.text('Atas pencapaian cemerlang dalam', 148.5, 125, { align: 'center' });
            
            doc.setFontSize(20);
            doc.setTextColor(34, 197, 94); // Green color
            doc.text('BACAAN AL-QURAN HARIAN', 148.5, 140, { align: 'center' });
            
            // Statistics
            doc.setFontSize(14);
            doc.setTextColor(50, 50, 50);
            doc.text(`${monthlyPages} Muka Surat Dibaca`, 100, 155, { align: 'center' });
            doc.text(`${percentage}% Target Tercapai`, 200, 155, { align: 'center' });
            
            // Month
            doc.setFontSize(16);
            doc.setTextColor(147, 51, 234); // Purple color
            doc.text(`Bulan: ${displayMonth}`, 148.5, 170, { align: 'center' });
            
            // Signatures
            doc.setFontSize(12);
            doc.setTextColor(50, 50, 50);
            doc.text('Guru Kelas', 80, 185, { align: 'center' });
            doc.text('Cikgu Aminah', 80, 192, { align: 'center' });
            
            doc.text('Tarikh', 220, 185, { align: 'center' });
            doc.text(today.toLocaleDateString('ms-MY'), 220, 192, { align: 'center' });
            
            // Signature lines
            doc.setDrawColor(150, 150, 150);
            doc.setLineWidth(0.5);
            doc.line(50, 182, 110, 182);
            doc.line(190, 182, 250, 182);
            
            // Motivational quote
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text('"Dan sesungguhnya telah Kami mudahkan Al-Quran untuk pelajaran,', 148.5, 205, { align: 'center' });
            doc.text('maka adakah orang yang mengambil pelajaran?" - Al-Qamar: 17', 148.5, 212, { align: 'center' });
            
            // Save the PDF
            const fileName = `Sijil_${studentName.replace(/\s+/g, '_')}_${monthName}_${year}.pdf`;
            doc.save(fileName);
            
            // Show success message
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successMessage').textContent = 
                `Sijil penghargaan untuk ${studentName} telah berjaya dimuat turun! ğŸ†ğŸ“¥`;
            
            // Close preview modal
            closeCertificatePreview();
        }

        // Analytics Functions
        function previewAnalytics() {
            const period = document.getElementById('reportPeriod').value;
            
            // Calculate statistics based on period
            const totalStudents = students.length;
            let averagePerformance, certificateEligible, needsAttention;
            
            if (period === 'daily') {
                // Daily statistics
                const todayCompleted = todayReading.filter(pages => pages >= 11).length;
                const todayAverage = Math.round(todayReading.reduce((sum, pages) => sum + pages, 0) / students.length);
                averagePerformance = Math.round((todayCompleted/totalStudents)*100);
                certificateEligible = todayCompleted;
                needsAttention = todayReading.filter(pages => pages === 0).length;
            } else {
                // Weekly/Monthly/Semester statistics
                const totalPerformance = studentProgress.reduce((sum, progress) => sum + Math.round((progress/77)*100), 0);
                averagePerformance = Math.round(totalPerformance / totalStudents);
                certificateEligible = monthlyProgress.filter(pages => pages >= monthlyTarget).length;
                needsAttention = studentProgress.filter(progress => Math.round((progress/77)*100) < 50).length;
            }
            
            // Update summary statistics
            document.getElementById('analyticsTotalStudents').textContent = totalStudents;
            document.getElementById('analyticsAveragePerformance').textContent = averagePerformance + '%';
            document.getElementById('analyticsCertificateEligible').textContent = certificateEligible;
            document.getElementById('analyticsNeedsAttention').textContent = needsAttention;
            
            // Update table headers based on period
            const tableHeader = document.getElementById('analyticsTableHeader');
            if (period === 'daily') {
                tableHeader.innerHTML = `
                    <th class="border border-gray-300 p-2 text-left">Nama Murid</th>
                    <th class="border border-gray-300 p-2 text-center">Hari Ini</th>
                    <th class="border border-gray-300 p-2 text-center">Juzuk</th>
                    <th class="border border-gray-300 p-2 text-center">Prestasi</th>
                    <th class="border border-gray-300 p-2 text-center">Status</th>
                    <th class="border border-gray-300 p-2 text-center">Catatan</th>
                `;
            } else {
                tableHeader.innerHTML = `
                    <th class="border border-gray-300 p-2 text-left">Nama Murid</th>
                    <th class="border border-gray-300 p-2 text-center">Minggu Ini</th>
                    <th class="border border-gray-300 p-2 text-center">Bulanan</th>
                    <th class="border border-gray-300 p-2 text-center">Prestasi</th>
                    <th class="border border-gray-300 p-2 text-center">Status</th>
                    <th class="border border-gray-300 p-2 text-center">Hari Lengkap</th>
                `;
            }
            
            // Populate detailed table
            const tableBody = document.getElementById('analyticsTableBody');
            tableBody.innerHTML = '';
            
            students.forEach((student, index) => {
                let row;
                
                if (period === 'daily') {
                    // Daily view
                    const todayPages = todayReading[index];
                    const dailyTarget = 11;
                    const dailyPercentage = Math.round((todayPages/dailyTarget)*100);
                    const currentDayIndex = 4; // Thursday (today)
                    const todayData = window.studentDailyData[index][currentDayIndex];
                    const juzuk = todayData ? todayData.juzuk : 1;
                    
                    let status = '';
                    let statusClass = '';
                    
                    if (todayPages >= dailyTarget) {
                        status = 'Selesai';
                        statusClass = 'bg-green-100 text-green-800';
                    } else if (todayPages >= dailyTarget * 0.7) {
                        status = 'Hampir Selesai';
                        statusClass = 'bg-yellow-100 text-yellow-800';
                    } else if (todayPages > 0) {
                        status = 'Dalam Progress';
                        statusClass = 'bg-blue-100 text-blue-800';
                    } else {
                        status = 'Belum Mula';
                        statusClass = 'bg-red-100 text-red-800';
                    }
                    
                    row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="border border-gray-300 p-2 font-medium">${student}</td>
                        <td class="border border-gray-300 p-2 text-center">${todayPages}/11</td>
                        <td class="border border-gray-300 p-2 text-center">Juzuk ${juzuk}</td>
                        <td class="border border-gray-300 p-2 text-center">
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: ${Math.min(dailyPercentage, 100)}%"></div>
                            </div>
                            <span class="text-xs">${dailyPercentage}%</span>
                        </td>
                        <td class="border border-gray-300 p-2 text-center">
                            <span class="${statusClass} px-2 py-1 rounded-full text-xs font-medium">${status}</span>
                        </td>
                        <td class="border border-gray-300 p-2 text-center">${todayData && todayData.notes ? 'Ada' : 'Tiada'}</td>
                    `;
                } else {
                    // Weekly/Monthly/Semester view
                    const weeklyPages = studentProgress[index];
                    const monthlyPages = monthlyProgress[index];
                    const weeklyPercentage = Math.round((weeklyPages/77)*100);
                    const monthlyPercentage = Math.round((monthlyPages/monthlyTarget)*100);
                    const completedDays = studentWeeklyData[index].filter(day => day >= 11).length;
                    
                    let status = '';
                    let statusClass = '';
                    
                    if (monthlyPages >= monthlyTarget) {
                        status = 'Layak Sijil';
                        statusClass = 'bg-yellow-100 text-yellow-800';
                    } else if (weeklyPercentage >= 70) {
                        status = 'Cemerlang';
                        statusClass = 'bg-green-100 text-green-800';
                    } else if (weeklyPercentage >= 50) {
                        status = 'Baik';
                        statusClass = 'bg-blue-100 text-blue-800';
                    } else {
                        status = 'Perlu Perhatian';
                        statusClass = 'bg-red-100 text-red-800';
                    }
                    
                    row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="border border-gray-300 p-2 font-medium">${student}</td>
                        <td class="border border-gray-300 p-2 text-center">${weeklyPages}/77 (${weeklyPercentage}%)</td>
                        <td class="border border-gray-300 p-2 text-center">${monthlyPages}/308 (${monthlyPercentage}%)</td>
                        <td class="border border-gray-300 p-2 text-center">
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: ${weeklyPercentage}%"></div>
                            </div>
                            <span class="text-xs">${weeklyPercentage}%</span>
                        </td>
                        <td class="border border-gray-300 p-2 text-center">
                            <span class="${statusClass} px-2 py-1 rounded-full text-xs font-medium">${status}</span>
                        </td>
                        <td class="border border-gray-300 p-2 text-center">${completedDays}/7</td>
                    `;
                }
                
                tableBody.appendChild(row);
            });
            
            // Show modal
            document.getElementById('analyticsPreviewModal').classList.remove('hidden');
        }

        function closeAnalyticsPreview() {
            document.getElementById('analyticsPreviewModal').classList.add('hidden');
        }

        function downloadAnalytics() {
            previewAnalytics();
        }

        function downloadAnalyticsFromPreview() {
            const period = document.getElementById('reportPeriod').value;
            let periodText = '';
            
            switch(period) {
                case 'daily': periodText = 'Harian'; break;
                case 'weekly': periodText = 'Mingguan'; break;
                case 'monthly': periodText = 'Bulanan'; break;
                case 'semester': periodText = 'Semester'; break;
            }
            
            // Create CSV content
            let csvContent = `Laporan Analisa ${periodText} - Kelas 6 Aktif\n`;
            csvContent += `Tarikh: ${new Date().toLocaleDateString('ms-MY')}\n\n`;
            
            if (period === 'daily') {
                // Daily report format
                csvContent += `Nama Murid,Hari Ini (Muka Surat),Target Harian,Pencapaian (%),Status Hari Ini,Juzuk,Catatan\n`;
            } else {
                csvContent += `Nama Murid,Minggu Ini (Muka Surat),Minggu Ini (%),Bulanan (Muka Surat),Bulanan (%),Status,Hari Lengkap\n`;
            }
            
            students.forEach((student, index) => {
                if (period === 'daily') {
                    // Daily report data
                    const todayPages = todayReading[index];
                    const dailyTarget = 11;
                    const dailyPercentage = Math.round((todayPages/dailyTarget)*100);
                    const currentDayIndex = 4; // Thursday (today)
                    const todayData = window.studentDailyData[index][currentDayIndex];
                    const juzuk = todayData ? todayData.juzuk : 1;
                    const notes = todayData ? (todayData.notes || 'Tiada catatan') : 'Tiada catatan';
                    
                    let dailyStatus = '';
                    if (todayPages >= dailyTarget) {
                        dailyStatus = 'Selesai';
                    } else if (todayPages >= dailyTarget * 0.7) {
                        dailyStatus = 'Hampir Selesai';
                    } else if (todayPages > 0) {
                        dailyStatus = 'Dalam Progress';
                    } else {
                        dailyStatus = 'Belum Mula';
                    }
                    
                    csvContent += `${student},${todayPages},${dailyTarget},${dailyPercentage}%,${dailyStatus},${juzuk},"${notes}"\n`;
                } else {
                    // Weekly/Monthly/Semester report data
                    const weeklyPages = studentProgress[index];
                    const monthlyPages = monthlyProgress[index];
                    const weeklyPercentage = Math.round((weeklyPages/77)*100);
                    const monthlyPercentage = Math.round((monthlyPages/monthlyTarget)*100);
                    const completedDays = studentWeeklyData[index].filter(day => day >= 11).length;
                    
                    let status = '';
                    if (monthlyPages >= monthlyTarget) {
                        status = 'Layak Sijil';
                    } else if (weeklyPercentage >= 70) {
                        status = 'Cemerlang';
                    } else if (weeklyPercentage >= 50) {
                        status = 'Baik';
                    } else {
                        status = 'Perlu Perhatian';
                    }
                    
                    csvContent += `${student},${weeklyPages}/77,${weeklyPercentage}%,${monthlyPages}/308,${monthlyPercentage}%,${status},${completedDays}/7\n`;
                }
            });
            
            // Add summary statistics
            csvContent += `\nRingkasan:\n`;
            csvContent += `Jumlah Murid,${students.length}\n`;
            
            if (period === 'daily') {
                // Daily summary
                const todayCompleted = todayReading.filter(pages => pages >= 11).length;
                const todayInProgress = todayReading.filter(pages => pages > 0 && pages < 11).length;
                const todayNotStarted = todayReading.filter(pages => pages === 0).length;
                const todayAverage = Math.round(todayReading.reduce((sum, pages) => sum + pages, 0) / students.length);
                
                csvContent += `Selesai Hari Ini,${todayCompleted}\n`;
                csvContent += `Dalam Progress,${todayInProgress}\n`;
                csvContent += `Belum Mula,${todayNotStarted}\n`;
                csvContent += `Purata Muka Surat Hari Ini,${todayAverage}\n`;
                csvContent += `Pencapaian Harian,${Math.round((todayCompleted/students.length)*100)}%\n`;
            } else {
                csvContent += `Purata Prestasi,${Math.round(studentProgress.reduce((sum, progress) => sum + Math.round((progress/77)*100), 0) / students.length)}%\n`;
                csvContent += `Layak Sijil,${monthlyProgress.filter(pages => pages >= monthlyTarget).length}\n`;
                csvContent += `Perlu Perhatian,${studentProgress.filter(progress => Math.round((progress/77)*100) < 50).length}\n`;
            }
            
            // Download CSV file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Analisa_${periodText}_Kelas6Aktif_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show success message
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successMessage').textContent = 
                `Laporan analisa ${periodText.toLowerCase()} telah berjaya dimuat turun! ğŸ“ŠğŸ“¥`;
            
            closeAnalyticsPreview();
        }

        // Student Management Functions
        function openAddStudentModal() {
            document.getElementById('newStudentName').value = '';
            document.getElementById('addStudentModal').classList.remove('hidden');
        }

        function closeAddStudentModal() {
            document.getElementById('newStudentName').value = '';
            document.getElementById('newParentID').value = '';
            document.getElementById('addStudentModal').classList.add('hidden');
        }

        function addNewStudent() {
            const newName = document.getElementById('newStudentName').value.trim();
            const newParentID = document.getElementById('newParentID').value.trim();
            
            if (!newName) {
                alert('Sila masukkan nama murid');
                return;
            }
            
            if (!newParentID) {
                alert('Sila masukkan No. Kad Pengenalan ibu bapa');
                return;
            }
            
            // Validate IC format
            const icPattern = /^\d{6}-\d{2}-\d{4}$/;
            if (!icPattern.test(newParentID)) {
                alert('Format No. Kad Pengenalan tidak sah. Sila gunakan format: YYMMDD-PP-XXXX');
                return;
            }
            
            if (students.includes(newName)) {
                alert('Nama murid sudah wujud dalam senarai');
                return;
            }
            
            // Check if parent ID already exists
            if (Object.values(parentIDs).includes(newParentID)) {
                alert('No. Kad Pengenalan ini sudah didaftarkan untuk murid lain');
                return;
            }
            
            // Add to students array
            const newIndex = students.length;
            students.push(newName);
            
            // Add parent ID mapping
            parentIDs[newIndex] = newParentID;
            
            // Initialize data for new student
            studentProgress.push(0);
            monthlyProgress.push(0);
            semesterProgress.push(0);
            todayReading.push(0);
            studentWeeklyData.push([0, 0, 0, 0, 0, 0, 0]);
            
            // Initialize daily data and history
            window.studentDailyData[newIndex] = {};
            window.studentDataHistory[newIndex] = {};
            
            weekDays.forEach((day, dayIndex) => {
                window.studentDailyData[newIndex][dayIndex] = {
                    pages: 0,
                    juzuk: 1,
                    notes: '',
                    lastUpdated: null,
                    updatedBy: null
                };
                window.studentDataHistory[newIndex][dayIndex] = [];
            });
            
            // Update all dropdowns
            updateAllStudentDropdowns();
            
            // Update displays
            updateTeacherTable();
            
            // Show success message
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successMessage').textContent = 
                `Murid baru "${newName}" telah berjaya ditambah ke dalam sistem dengan No. IC ibu bapa: ${newParentID} ğŸ‘¥â•`;
            
            closeAddStudentModal();
        }

        function openRemoveStudentModal() {
            const select = document.getElementById('removeStudentSelect');
            select.innerHTML = '<option value="">-- Pilih Murid --</option>';
            
            students.forEach((student, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = student;
                select.appendChild(option);
            });
            
            document.getElementById('removeStudentModal').classList.remove('hidden');
        }

        function closeRemoveStudentModal() {
            document.getElementById('removeStudentModal').classList.add('hidden');
        }

        function removeStudent() {
            const studentIndex = parseInt(document.getElementById('removeStudentSelect').value);
            const reason = document.getElementById('removalReason').value;
            
            if (isNaN(studentIndex)) {
                alert('Sila pilih murid untuk dikeluarkan');
                return;
            }
            
            const studentName = students[studentIndex];
            
            if (!confirm(`Adakah anda pasti ingin mengeluarkan "${studentName}" dari sistem? Tindakan ini tidak boleh dibatalkan.`)) {
                return;
            }
            
            // Remove from all arrays
            students.splice(studentIndex, 1);
            studentProgress.splice(studentIndex, 1);
            monthlyProgress.splice(studentIndex, 1);
            semesterProgress.splice(studentIndex, 1);
            todayReading.splice(studentIndex, 1);
            studentWeeklyData.splice(studentIndex, 1);
            
            // Remove from data structures
            delete window.studentDailyData[studentIndex];
            delete window.studentDataHistory[studentIndex];
            delete parentIDs[studentIndex];
            if (window.confirmedReadings && window.confirmedReadings[studentIndex]) {
                delete window.confirmedReadings[studentIndex];
            }
            if (window.studentComments && window.studentComments[studentIndex]) {
                delete window.studentComments[studentIndex];
            }
            
            // Reindex remaining data
            const newStudentDailyData = {};
            const newStudentDataHistory = {};
            const newConfirmedReadings = {};
            const newStudentComments = {};
            const newParentIDs = {};
            
            let newIndex = 0;
            for (let oldIndex = 0; oldIndex < students.length + 1; oldIndex++) {
                if (oldIndex === studentIndex) continue;
                
                if (window.studentDailyData[oldIndex]) {
                    newStudentDailyData[newIndex] = window.studentDailyData[oldIndex];
                }
                if (window.studentDataHistory[oldIndex]) {
                    newStudentDataHistory[newIndex] = window.studentDataHistory[oldIndex];
                }
                if (window.confirmedReadings && window.confirmedReadings[oldIndex]) {
                    newConfirmedReadings[newIndex] = window.confirmedReadings[oldIndex];
                }
                if (window.studentComments && window.studentComments[oldIndex]) {
                    newStudentComments[newIndex] = window.studentComments[oldIndex];
                }
                if (parentIDs[oldIndex]) {
                    newParentIDs[newIndex] = parentIDs[oldIndex];
                }
                
                newIndex++;
            }
            
            window.studentDailyData = newStudentDailyData;
            window.studentDataHistory = newStudentDataHistory;
            window.confirmedReadings = newConfirmedReadings;
            window.studentComments = newStudentComments;
            Object.assign(parentIDs, newParentIDs);
            
            // Clear old parent IDs
            Object.keys(parentIDs).forEach(key => {
                if (!newParentIDs[key]) {
                    delete parentIDs[key];
                }
            });
            
            // Reset selected student if it was the removed one
            if (selectedStudentIndex == studentIndex) {
                selectedStudentIndex = null;
                document.getElementById('studentSelect').value = '';
                document.getElementById('studentDataContainer').classList.add('hidden');
            } else if (selectedStudentIndex > studentIndex) {
                selectedStudentIndex--;
            }
            
            // Update all dropdowns and displays
            updateAllStudentDropdowns();
            updateTeacherTable();
            
            // Show success message
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successMessage').textContent = 
                `Murid "${studentName}" telah dikeluarkan dari sistem. Sebab: ${getRemovalReasonText(reason)} ğŸ‘¥â–`;
            
            closeRemoveStudentModal();
        }

        function getRemovalReasonText(reason) {
            switch(reason) {
                case 'transfer': return 'Berpindah Sekolah';
                case 'class_change': return 'Tukar Kelas';
                case 'other': return 'Lain-lain';
                default: return 'Tidak Dinyatakan';
            }
        }

        function openEditStudentModal() {
            const select = document.getElementById('editStudentSelect');
            select.innerHTML = '<option value="">-- Pilih Murid --</option>';
            
            students.forEach((student, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = student;
                select.appendChild(option);
            });
            
            document.getElementById('editStudentName').value = '';
            document.getElementById('editStudentModal').classList.remove('hidden');
        }

        function closeEditStudentModal() {
            document.getElementById('editStudentModal').classList.add('hidden');
        }

        function loadStudentForEdit() {
            const studentIndex = document.getElementById('editStudentSelect').value;
            
            if (studentIndex !== '') {
                document.getElementById('editStudentName').value = students[studentIndex];
            } else {
                document.getElementById('editStudentName').value = '';
            }
        }

        function updateStudentName() {
            const studentIndex = parseInt(document.getElementById('editStudentSelect').value);
            const newName = document.getElementById('editStudentName').value.trim();
            
            if (isNaN(studentIndex)) {
                alert('Sila pilih murid untuk diedit');
                return;
            }
            
            if (!newName) {
                alert('Sila masukkan nama baru');
                return;
            }
            
            if (students.includes(newName) && students[studentIndex] !== newName) {
                alert('Nama murid sudah wujud dalam senarai');
                return;
            }
            
            const oldName = students[studentIndex];
            students[studentIndex] = newName;
            
            // Update all dropdowns and displays
            updateAllStudentDropdowns();
            updateTeacherTable();
            
            // Update selected student display if needed
            if (selectedStudentIndex == studentIndex) {
                loadSelectedStudent();
            }
            
            // Show success message
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successMessage').textContent = 
                `Nama murid telah dikemaskini dari "${oldName}" kepada "${newName}" âœï¸âœ…`;
            
            closeEditStudentModal();
        }

        function updateAllStudentDropdowns() {
            // Update all student dropdowns
            const dropdowns = [
                'studentSelect',
                'parentStudentSelect', 
                'teacherStudentSelect',
                'certificateStudentSelect'
            ];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                const currentValue = dropdown.value;
                
                // Clear and repopulate
                dropdown.innerHTML = '<option value="">-- Pilih Murid --</option>';
                
                students.forEach((student, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = student;
                    dropdown.appendChild(option);
                });
                
                // Restore selection if still valid
                if (currentValue !== '' && currentValue < students.length) {
                    dropdown.value = currentValue;
                }
            });
        }

        // Dashboard Functions
        function loadDashboardData() {
            // Calculate statistics
            const totalStudents = students.length;
            const khatamCount = semesterProgress.filter(progress => progress >= khatamTarget).length;
            const certificateCount = monthlyProgress.filter(progress => progress >= monthlyTarget).length;
            const totalPerformance = studentProgress.reduce((sum, progress) => sum + Math.round((progress/77)*100), 0);
            const averagePerformance = Math.round(totalPerformance / totalStudents);
            const needsAttentionCount = studentProgress.filter(progress => Math.round((progress/77)*100) < 50).length;
            
            // Update main statistics
            document.getElementById('dashTotalStudents').textContent = totalStudents;
            document.getElementById('dashKhatamCount').textContent = khatamCount;
            document.getElementById('dashCertificateCount').textContent = certificateCount;
            document.getElementById('dashAveragePerformance').textContent = averagePerformance + '%';
            document.getElementById('dashNeedsAttention').textContent = needsAttentionCount;
            
            // Calculate performance distribution
            let excellentCount = 0, goodCount = 0, averageCount = 0, attentionCount = 0;
            
            studentProgress.forEach(progress => {
                const percentage = Math.round((progress/77)*100);
                if (percentage >= 90) excellentCount++;
                else if (percentage >= 70) goodCount++;
                else if (percentage >= 50) averageCount++;
                else attentionCount++;
            });
            
            document.getElementById('excellentCount').textContent = excellentCount;
            document.getElementById('goodCount').textContent = goodCount;
            document.getElementById('averageCount').textContent = averageCount;
            document.getElementById('attentionCount').textContent = attentionCount;
            
            // Update weekly progress chart
            const weeklyTargetAchieved = studentProgress.filter(progress => Math.round((progress/77)*100) >= 70).length;
            const weeklyPercentage = Math.round((weeklyTargetAchieved / totalStudents) * 100);
            
            document.getElementById('weeklyTargetAchieved').textContent = `${weeklyTargetAchieved} murid`;
            document.getElementById('weeklyProgressChart').style.width = `${weeklyPercentage}%`;
            
            // Update monthly statistics
            const monthlyTotal = monthlyProgress.reduce((sum, progress) => sum + progress, 0);
            const monthlyAverage = Math.round(monthlyTotal / totalStudents);
            
            document.getElementById('monthlyAverage').textContent = monthlyAverage;
            document.getElementById('monthlyEligible').textContent = certificateCount;
            
            // Load top performers
            loadTopPerformers();
        }

        function loadTopPerformers() {
            const topPerformersContainer = document.getElementById('topPerformers');
            topPerformersContainer.innerHTML = '';
            
            // Create array of students with their performance data
            const studentsWithPerformance = students.map((student, index) => ({
                name: student,
                index: index,
                weeklyProgress: studentProgress[index],
                weeklyPercentage: Math.round((studentProgress[index]/77)*100),
                monthlyProgress: monthlyProgress[index],
                semesterProgress: semesterProgress[index],
                isKhatam: semesterProgress[index] >= khatamTarget,
                isCertificateEligible: monthlyProgress[index] >= monthlyTarget
            }));
            
            // Sort by weekly percentage (descending)
            studentsWithPerformance.sort((a, b) => b.weeklyPercentage - a.weeklyPercentage);
            
            // Display top 5 performers
            const topPerformers = studentsWithPerformance.slice(0, 5);
            
            topPerformers.forEach((student, rank) => {
                let statusBadge = '';
                let statusClass = '';
                
                if (student.isKhatam) {
                    statusBadge = 'ğŸ† KHATAM';
                    statusClass = 'bg-gradient-to-r from-purple-100 to-pink-100 text-purple-800 border border-purple-300';
                } else if (student.isCertificateEligible) {
                    statusBadge = 'ğŸ† LAYAK SIJIL';
                    statusClass = 'bg-gradient-to-r from-yellow-100 to-orange-100 text-yellow-800 border border-yellow-300';
                } else if (student.weeklyPercentage >= 90) {
                    statusBadge = 'â­ CEMERLANG';
                    statusClass = 'bg-green-100 text-green-800';
                } else if (student.weeklyPercentage >= 70) {
                    statusBadge = 'ğŸ‘ BAIK';
                    statusClass = 'bg-blue-100 text-blue-800';
                } else {
                    statusBadge = 'ğŸ“š SEDERHANA';
                    statusClass = 'bg-yellow-100 text-yellow-800';
                }
                
                const performerElement = document.createElement('div');
                performerElement.className = `flex items-center justify-between p-3 rounded-lg border-l-4 ${
                    rank === 0 ? 'border-gold bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-400' :
                    rank === 1 ? 'border-silver bg-gray-50 border-gray-400' :
                    rank === 2 ? 'border-bronze bg-orange-50 border-orange-400' :
                    'border-blue-300 bg-blue-50'
                }`;
                
                performerElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl font-bold ${
                            rank === 0 ? 'text-yellow-600' :
                            rank === 1 ? 'text-gray-600' :
                            rank === 2 ? 'text-orange-600' :
                            'text-blue-600'
                        }">#${rank + 1}</div>
                        <div>
                            <div class="font-semibold text-gray-800">${student.name}</div>
                            <div class="text-sm text-gray-600">${student.weeklyProgress}/77 muka surat (${student.weeklyPercentage}%)</div>
                            <span class="${statusClass} px-2 py-1 rounded-full text-xs font-medium mt-1 inline-block">${statusBadge}</span>
                        </div>
                    </div>
                    <div class="text-right">
                        ${rank === 0 ? '<div class="text-2xl">ğŸ¥‡</div>' :
                          rank === 1 ? '<div class="text-2xl">ğŸ¥ˆ</div>' :
                          rank === 2 ? '<div class="text-2xl">ğŸ¥‰</div>' :
                          '<div class="text-xl">ğŸ…</div>'}
                        <div class="text-xs text-gray-500 mt-1">
                            ${student.isKhatam ? 'KHATAM' : 
                              student.isCertificateEligible ? 'SIJIL' : 
                              student.weeklyPercentage >= 70 ? 'TARGET' : 'PROGRESS'}
                        </div>
                    </div>
                `;
                
                topPerformersContainer.appendChild(performerElement);
            });
        }

        function downloadDashboardReport() {
            // Create comprehensive dashboard report
            let csvContent = `Laporan Dashboard Sistem DeMas - Kelas 6 Aktif\n`;
            csvContent += `Tarikh: ${new Date().toLocaleDateString('ms-MY')}\n`;
            csvContent += `Minggu: 21 - 27 Disember 2024\n\n`;
            
            // Summary Statistics
            csvContent += `RINGKASAN KESELURUHAN:\n`;
            csvContent += `Jumlah Murid,${students.length}\n`;
            csvContent += `Pencapai KHATAM,${semesterProgress.filter(p => p >= khatamTarget).length}\n`;
            csvContent += `Layak Sijil Bulanan,${monthlyProgress.filter(p => p >= monthlyTarget).length}\n`;
            csvContent += `Purata Prestasi Mingguan,${Math.round(studentProgress.reduce((sum, progress) => sum + Math.round((progress/77)*100), 0) / students.length)}%\n`;
            csvContent += `Perlu Perhatian,${studentProgress.filter(progress => Math.round((progress/77)*100) < 50).length}\n\n`;
            
            // Performance Distribution
            let excellentCount = 0, goodCount = 0, averageCount = 0, attentionCount = 0;
            studentProgress.forEach(progress => {
                const percentage = Math.round((progress/77)*100);
                if (percentage >= 90) excellentCount++;
                else if (percentage >= 70) goodCount++;
                else if (percentage >= 50) averageCount++;
                else attentionCount++;
            });
            
            csvContent += `TABURAN PRESTASI:\n`;
            csvContent += `Cemerlang (90%+),${excellentCount}\n`;
            csvContent += `Baik (70-89%),${goodCount}\n`;
            csvContent += `Sederhana (50-69%),${averageCount}\n`;
            csvContent += `Perlu Perhatian (<50%),${attentionCount}\n\n`;
            
            // Detailed Student Data
            csvContent += `DATA TERPERINCI MURID:\n`;
            csvContent += `Nama,Mingguan (MS),Mingguan (%),Bulanan (MS),Bulanan (%),Semester (MS),Status KHATAM,Status Sijil\n`;
            
            students.forEach((student, index) => {
                const weeklyPages = studentProgress[index];
                const weeklyPercentage = Math.round((weeklyPages/77)*100);
                const monthlyPages = monthlyProgress[index];
                const monthlyPercentage = Math.round((monthlyPages/monthlyTarget)*100);
                const semesterPages = semesterProgress[index];
                const isKhatam = semesterPages >= khatamTarget ? 'YA' : 'TIDAK';
                const isCertificateEligible = monthlyPages >= monthlyTarget ? 'LAYAK' : 'TIDAK LAYAK';
                
                csvContent += `${student},${weeklyPages},${weeklyPercentage}%,${monthlyPages},${monthlyPercentage}%,${semesterPages},${isKhatam},${isCertificateEligible}\n`;
            });
            
            // Top Performers
            const studentsWithPerformance = students.map((student, index) => ({
                name: student,
                weeklyPercentage: Math.round((studentProgress[index]/77)*100)
            }));
            studentsWithPerformance.sort((a, b) => b.weeklyPercentage - a.weeklyPercentage);
            
            csvContent += `\nPENCAPAI TERBAIK MINGGU INI:\n`;
            studentsWithPerformance.slice(0, 5).forEach((student, index) => {
                csvContent += `${index + 1},${student.name},${student.weeklyPercentage}%\n`;
            });
            
            // Download the file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Dashboard_Report_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show success message
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successMessage').textContent = 
                'Laporan dashboard lengkap telah berjaya dimuat turun! ğŸ“ŠğŸ“¥ Termasuk analisis prestasi, taburan murid, dan senarai pencapai terbaik.';
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeWeeklySchedule();
            updateProgressBar();
            updateTeacherTable();
            loadDashboardData(); // Load dashboard data on startup
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97b365bf274d3c57',t:'MTc1NzIxODY1Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
